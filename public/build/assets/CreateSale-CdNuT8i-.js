import{r as o,d as re,f as de,n as O,k as U,q as b,e as ce,o as n,l as ue,h as pe,a as e,b as d,v,m as T,c as i,j as x,t as r,F as w,s as W}from"./app-C2i026LC.js";import{_ as me}from"./AdminLayout-DxRoeMN4.js";import{$ as V}from"./dataTables.bootstrap4.min-73PbsmZ0.js";import"./AdminFooter-BK7-hYHZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"row mb-2"},he={class:"col-sm-6"},fe={class:"breadcrumb float-sm-right mt-2"},be={class:"breadcrumb-item"},ge=["href"],ye={class:"breadcrumb-item active"},_e=["href"],xe={class:"row mb-4"},we={class:"col-12"},Se={class:"row d-flex justify-content-start"},Ce={class:"col-lg-3 col-12"},ke={class:"input-group mb-3"},Pe={class:"col-lg-3 col-12"},Te={class:"input-group mb-3"},De=["value"],Ie={class:"col-lg-3 col-12"},Ue={class:"input-group mb-3"},Ve=["disabled"],Ee=["value"],Be={class:"col-lg-3 col-12"},Re={class:"input-group mb-3"},$e=["value"],Me={class:"col-lg-6"},qe={class:"input-group mb-3"},Ae={key:0,class:"search-result",id:"shopResult"},je={class:"shop-list"},Fe=["onClick"],Ne={key:1,class:"search-result"},Ge={class:"col-lg-6"},Le={class:"input-group mb-3"},Oe={key:0,class:"search-result",id:"search_result"},We={class:"product-list"},Qe=["onClick"],He={key:1,class:"search-result"},ze={class:"row",style:{"margin-top":"80px"}},Xe={class:"col-12"},Je={class:"card card-primary"},Ke={class:"card-body"},Ye={id:"perchesTable",class:"table table-hover"},Ze=["onUpdate:modelValue"],es=["onUpdate:modelValue","onInput"],ss={class:"row d-flex"},ts={class:"input-group quantity-group"},ls=["onClick"],os=["onUpdate:modelValue"],as=["onClick"],ns={class:"justify-content-center align-items-center"},is=["onClick"],rs={class:"row d-flex justify-content-end"},ds={class:"col-lg-4"},cs={class:"card card-success card-outline"},us={class:"card-body"},ps={class:"col-12"},ms={class:"input-group mb-3"},vs={class:"input-group-text",id:"basic-addon2"},xs={__name:"CreateSale",props:{ref_data:Object},setup(Q){o(null);const u=re();o(0);const p=o(""),h=o(""),S=o(""),f=o(3),m=o([]),g=o(0),C=o(0),k=o(0),c=o([]),D=o(0),H=o(""),z=o(""),X=o(""),I=o(1),P=o([]),E=o(!1);o(""),o({});const B=Q,J=async()=>{const l=M(C.value),t={warehouse_id:g.value,products:c.value.map(s=>({product_id:s.id,quantity:+s.sellCount,price:s.price,discount:s.discount??0,discounted_price:y(s),subtotal:y(s)*s.quantity})),total_price:A.value,received_amount:D.value,payment_type:+f.value,todyDate:S.value,shop_id:C.value,ref_id:k.value,credit:l,bank_name:H.value,cheque_number:X.value,expire_date:z.value,order_status:I.value};b.post("/sales",t).then(s=>{var a,_;console.log(s),(a=s==null?void 0:s.data)!=null&&a.message?(localStorage.setItem("successMessage",s.data.message),window.location.href=route("admin.Sales")):(_=s==null?void 0:s.data)!=null&&_.error&&u.error(s.data.error)}).catch(s=>{var a,_,F,N,G,L;(_=(a=s.response)==null?void 0:a.data)!=null&&_.errors?(console.log((N=(F=s.response)==null?void 0:F.data)==null?void 0:N.errors),Object.values(s.response.data.errors||{}).flat().forEach(ie=>{u.error(ie)})):(L=(G=s.response)==null?void 0:G.data)!=null&&L.message?u.error(s.response.data.message):u.error("An unexpected error occurred."),console.log(s)})},K=async(l,t)=>{if(t.value==0)u.warning("Please Select Warehouse"),document.getElementById("warehouse").style.border="1px solid red";else{document.getElementById("warehouse").style.border="1px solid black !important";try{const s=await b.get(`/admin/search/shop/${l}`);P.value=s.data}catch(s){s.response&&s.response.status===404?console.log(s.response.data.message):console.error("An error occurred:",s)}}},Y=async(l,t)=>{if(t.value==0)u.warning("Please Select Warehouse"),document.getElementById("warehouse").style.border="1px solid red";else{document.getElementById("warehouse").style.border="1px solid black !important";try{const s=await b.get(`/admin/search/${l}/${t}`);m.value=s.data,Array.isArray(m)?console.log("Products found:",m):console.log("Single product found:",m)}catch(s){s.response&&s.response.status===404?console.log(s.response.data.message):console.error("An error occurred:",s)}}};de(()=>{ee(),se(),ae();const l=new Date().toISOString().split("T")[0];S.value=l,B.ref_data&&(k.value=B.ref_data.id,E.value=!0),O(()=>{Z()})});function Z(){O(()=>{V.fn.DataTable.isDataTable("#perchesTable")&&V("#perchesTable").DataTable().destroy(),V("#perchesTable").DataTable({responsive:!0,scrollX:!0,scrollCollapse:!0,paging:!0});const l=localStorage.getItem("successMessage");l&&(u.success(l),localStorage.removeItem("successMessage"))})}U(p,()=>{Y(p.value,g.value)}),U(f,()=>{console.log("ss"+f.value),f.value==2?document.getElementById("cheque").style.display="block":document.getElementById("cheque").style.display="none"});const R=o([]),ee=async()=>{try{const l=await b.get("/warehouses");R.value=l.data}catch(l){console.error("Error fetching courses:",l)}},$=o([]),se=async()=>{try{const l=await b.get("/shops");$.value=l.data}catch(l){console.error("Error fetching courses:",l)}},M=l=>{const t=$.value.find(s=>s.id===l);return t?t.credit_limit-t.credit:0},te=l=>{const t=c.value.find(s=>s.id===l.id);t?t.sellCount+=1:c.value.push({...l,sellCount:1}),p.value="",document.getElementById("search_result").style.display="none"},le=l=>{c.value=c.value.filter(t=>t.id!==l)},q=(l,t)=>{const s=c.value.find(a=>a.id===l);s&&(s.sellCount=Math.max(1,s.sellCount+t))},oe=l=>{l.discount<0?l.discount=0:l.discount>100&&(l.discount=100)},y=l=>{const t=l.discount??0,s=l.price*t/100;return l.price-s},A=ce(()=>c.value.reduce((l,t)=>{const s=y(t);return l+s*t.sellCount},0)),j=o([]),ae=async()=>{try{const l=await b.get("/refs");j.value=l.data,console.log(l)}catch(l){console.error("Error fetching courses:",l)}};o([]),U(h,()=>{K(h.value,g.value)});function ne(l,t){C.value=l,h.value=t,document.getElementById("shopResult").style.display="none"}return(l,t)=>(n(),ue(me,null,{default:pe(()=>[e("div",ve,[t[9]||(t[9]=e("div",{class:"col-sm-6"},[e("h5",{class:"mt-2"},"CREATE SALES")],-1)),e("div",he,[e("ol",fe,[e("li",be,[e("a",{href:l.route("admin.dashboard")},"Home",8,ge)]),e("li",ye,[e("a",{href:l.route("admin.Sales")},"Sales",8,_e)]),t[8]||(t[8]=e("li",{class:"breadcrumb-item active"},"Create Sales",-1))])])]),e("div",xe,[e("div",we,[e("div",Se,[e("div",Ce,[e("div",ke,[t[10]||(t[10]=e("span",{class:"input-group-text",id:"basic-addon1"},[e("img",{src:"/images/icon/calendar.svg",alt:"",width:"20px"})],-1)),d(e("input",{type:"date",class:"form-control",placeholder:"Username","aria-label":"Username","onUpdate:modelValue":t[0]||(t[0]=s=>S.value=s),"aria-describedby":"basic-addon1",id:"dateInput",required:""},null,512),[[v,S.value]])])]),e("div",Pe,[e("div",Te,[t[12]||(t[12]=e("label",{class:"input-group-text",for:"inputGroupSelect01"},[e("img",{src:"/images/icon/sale create warehouse.svg",alt:"",width:"20px"})],-1)),d(e("select",{class:"form-select",id:"warehouse","onUpdate:modelValue":t[1]||(t[1]=s=>g.value=s)},[t[11]||(t[11]=e("option",{selected:"",disabled:"",value:"0"},"Select WareHouse",-1)),(n(!0),i(w,null,x(R.value,s=>(n(),i("option",{key:s.id,value:s.id},r(s.name),9,De))),128))],512),[[T,g.value]])])]),e("div",Ie,[e("div",Ue,[t[14]||(t[14]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/sale create  ref.svg",alt:"",width:"20px"})],-1)),d(e("select",{class:"form-select",id:"ref","onUpdate:modelValue":t[2]||(t[2]=s=>k.value=s),disabled:E.value},[t[13]||(t[13]=e("option",{selected:"",disabled:"",value:"0"},"Select Ref",-1)),(n(!0),i(w,null,x(j.value,s=>(n(),i("option",{key:s.id,value:s.id},r(s.first_name),9,Ee))),128))],8,Ve),[[T,k.value]])])]),e("div",Be,[e("div",Re,[t[15]||(t[15]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/sales_payments.svg",alt:"",width:"20px"})],-1)),e("input",{type:"number",class:"form-control",id:"credit_limit",value:M(C.value),disabled:""},null,8,$e)])]),e("div",Me,[e("div",qe,[t[16]||(t[16]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/search.svg",alt:"",width:"20px"})],-1)),d(e("input",{class:"form-control",type:"text",placeholder:"Search Shops...","aria-label":"default input example","onUpdate:modelValue":t[3]||(t[3]=s=>h.value=s)},null,512),[[v,h.value]])]),h.value&&P.value.length>0?(n(),i("div",Ae,[e("ol",je,[(n(!0),i(w,null,x(P.value,s=>(n(),i("li",{key:s.id,class:"product-item",style:{cursor:"pointer"},onClick:a=>ne(s.id,s.name)},r(s.name)+" - "+r(s.address),9,Fe))),128))])])):l.searched_shop&&P.value.length===0?(n(),i("div",Ne,t[17]||(t[17]=[e("p",null,"No shops found...",-1)]))):W("",!0)]),e("div",Ge,[e("div",Le,[t[18]||(t[18]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/search.svg",alt:"",width:"20px"})],-1)),d(e("input",{class:"form-control",type:"text",placeholder:"Search Products...","aria-label":"default input example","onUpdate:modelValue":t[4]||(t[4]=s=>p.value=s)},null,512),[[v,p.value]])]),p.value&&m.value.length>0?(n(),i("div",Oe,[e("ol",We,[(n(!0),i(w,null,x(m.value,s=>(n(),i("li",{key:s.id,onClick:a=>te(s),class:"product-item",style:{cursor:"pointer"}},r(s.name)+" ("+r(s.code)+") - Rs "+r(s.price),9,Qe))),128))])])):p.value&&m.value.length===0?(n(),i("div",He,t[19]||(t[19]=[e("p",null,"No products found...",-1)]))):W("",!0)])])])]),e("div",ze,[e("div",Xe,[e("div",Je,[t[22]||(t[22]=e("div",{class:"card-header card-header-background"},[e("h3",{class:"card-title"},"Sales Items")],-1)),e("div",Ke,[e("table",Ye,[t[21]||(t[21]=e("thead",null,[e("tr",null,[e("th",{style:{width:"20%"}},"Product Code"),e("th",{style:{width:"25%"}},"Product Name"),e("th",{style:{width:"10%"}},"Price (Rs.)"),e("th",{style:{width:"10%"}},"Discount (%)"),e("th",{style:{width:"10%"}},"Discount (Rs.)"),e("th",{style:{width:"10%"}},"Quantity"),e("th",{style:{width:"10%"}},"Subtotal (Rs.)"),e("th",{style:{"text-align":"center",width:"8%"}},"Action")])],-1)),e("tbody",null,[(n(!0),i(w,null,x(c.value,s=>(n(),i("tr",{key:s.id},[e("td",null,r(s.code),1),e("td",null,r(s.name),1),e("td",null,[d(e("input",{type:"number",class:"form-control","onUpdate:modelValue":a=>s.price=a,min:"0"},null,8,Ze),[[v,s.price]])]),e("td",null,[d(e("input",{type:"number",class:"form-control","onUpdate:modelValue":a=>s.discount=a,min:"0",max:"100",onInput:a=>oe(s),placeholder:"0"},null,40,es),[[v,s.discount]])]),e("td",null,r((s.price*s.sellCount).toFixed(2)-(y(s)*s.sellCount).toFixed(2)),1),e("td",null,[e("div",ss,[e("div",ts,[e("button",{class:"btn btn-primary",type:"button",onClick:a=>q(s.id,-1)}," - ",8,ls),d(e("input",{class:"form-control","aria-label":"Quantity input","onUpdate:modelValue":a=>s.sellCount=a,min:"1"},null,8,os),[[v,s.sellCount]]),e("button",{class:"btn btn-primary",type:"button",onClick:a=>q(s.id,1)}," + ",8,as)])])]),e("td",null,r((y(s)*s.sellCount).toFixed(2)),1),e("td",ns,[e("a",{onClick:a=>le(s.id),style:{cursor:"pointer"}},t[20]||(t[20]=[e("img",{src:"/images/icon/trash-bin.png",alt:"",width:"25px",height:"25px",class:"table-action-icon"},null,-1)]),8,is)])]))),128))])])])])])]),e("div",rs,[e("div",ds,[e("div",cs,[t[27]||(t[27]=e("div",{class:"card-header"},[e("h5",{class:"card-title fw-bold"},"Summary")],-1)),e("div",us,[e("div",ps,[e("div",ms,[e("span",vs,"Total: Rs "+r(A.value.toFixed(2)),1),d(e("input",{type:"number",class:"form-control",placeholder:"0.00","aria-label":"Recipient's username","aria-describedby":"basic-addon2","onUpdate:modelValue":t[5]||(t[5]=s=>D.value=s)},null,512),[[v,D.value]])]),t[25]||(t[25]=e("label",{for:"name"},"Payment Type",-1)),d(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":t[6]||(t[6]=s=>f.value=s)},t[23]||(t[23]=[e("option",{value:"",disabled:""},"Select Payment Type",-1),e("option",{value:"3"},"Credit",-1)]),512),[[T,f.value]]),t[26]||(t[26]=e("label",{for:"name"},"Order Status",-1)),d(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":t[7]||(t[7]=s=>I.value=s)},t[24]||(t[24]=[e("option",{value:"",disabled:""},"Select Order Status",-1),e("option",{value:"1"},"Start to Print",-1),e("option",{value:"2"},"Print",-1),e("option",{value:"3"},"Delivered",-1),e("option",{value:"4"},"Completed",-1)]),512),[[T,I.value]])]),e("div",{class:"row"},[e("div",{class:"col-12 text-end"},[e("button",{class:"btn btn-success mt-3",onClick:J},"Create Sale")])])])])])]),t[28]||(t[28]=e("div",{class:"offcanvas offcanvas-end","data-bs-scroll":"true","data-bs-backdrop":"false",tabindex:"-1",id:"offcanvasScrolling","aria-labelledby":"offcanvasScrollingLabel"},[e("div",{class:"offcanvas-header"},[e("h5",{class:"offcanvas-title",id:"offcanvasScrollingLabel"},"Category Name"),e("button",{type:"button",class:"btn-close text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"})]),e("div",{class:"offcanvas-body"},[e("div",{class:"row"},[e("div",{class:"container result_container"},[e("input",{class:"form-control",type:"text",placeholder:"Search Products...","aria-label":"default input example"}),e("div",{class:"search-result"},[e("p",null,"456 product")])])]),e("div",{class:"row mt-4"},[e("div",{class:"col-12"}," Product Name (Code) ")])])],-1))]),_:1}))}};export{xs as default};
