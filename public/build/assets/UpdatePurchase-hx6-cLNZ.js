import{Q as X,e as Y,r as l,f as z,p as j,j as J,i as K,o as i,g as Z,h as ee,a as e,d as c,k as S,c as d,l as y,t as n,F as b,v,s as te,n as B}from"./app-mDYLW31A.js";import{_ as se}from"./AdminLayout-UUPC1Aa5.js";import{$ as Q}from"./dataTables.bootstrap4.min-B2_zjVPS.js";import"./vue-quill.snow-BON5O7Yn.js";import"side-channel-list";import"side-channel-map";import"side-channel-weakmap";import"./AdminFooter-BVWJI1Iq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"row mb-2"},oe={class:"col-sm-6"},le={class:"breadcrumb float-sm-right"},ne={class:"breadcrumb-item"},ie=["href"],de={class:"breadcrumb-item active"},re=["href"],ue={class:"row mb-4"},ce={class:"col-12"},pe={class:"row d-flex justify-content-center"},me={class:"col-lg-3 col-12"},ve={class:"input-group mb-3"},he=["value"],_e={class:"col-lg-3 col-12"},ye={class:"input-group mb-3"},be=["value"],fe={class:"row"},ge={class:"container result_container"},xe={key:0,class:"search-result"},we=["onClick"],Pe={key:1,class:"search-result"},ke={class:"row mt-4"},Se={class:"col-12"},Ce={class:"card card-primary"},qe={class:"card-body"},Te={id:"perchesTable",class:"table table-hover"},Ue=["onUpdate:modelValue","onInput"],Ae={class:"row d-flex"},De={class:"input-group quantity-group"},Ve=["onClick"],Ee=["onUpdate:modelValue"],Re=["onClick"],Fe={class:"d-flex justify-content-center align-items-center"},Ie=["onClick"],Me={class:"row d-flex justify-content-end"},$e={class:"col-lg-4"},je={class:"card card-info card-outline"},Be={class:"card-body"},Qe={class:"col-lg-12"},Ge={class:"form-group"},He={class:"col-12"},Oe={class:"input-group mb-3"},Ne={class:"input-group-text",id:"basic-addon2"},Le={class:"col-12"},We={class:"form-group"},ot={__name:"UpdatePurchase",props:{purchase:{type:Object,default:()=>({})},suppliers:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},products:{type:Array,default:()=>[]}},setup(f){var T,U,A,D,V,E,R;X();const h=Y();l(null),l(0);const m=l(""),p=l("");l({code:"",name:"",cost:"",price:"",image:"",description:"",variation_id:"",category_id:""});const u=f,r=l((((T=u.purchase)==null?void 0:T.products)??[]).map(a=>({purchase_item_id:a.id,id:a.product_id,name:a.name,code:a.code,cost:a.cost,quantity:a.quantity,discount:a.discount,discounted_price:a.discounted_price||0,subtotal:a.subtotal,oldQuantity:a.oldQuantity}))),g=l(((U=u.purchase)==null?void 0:U.supplier_id)||null),x=l(((A=u.purchase)==null?void 0:A.warehouse_id)||null),w=l(((D=u.purchase)==null?void 0:D.payment_status)||null);l(((V=u.purchase)==null?void 0:V.order_status)||null);const P=l(((E=u.purchase)==null?void 0:E.received_amount)||null),k=l(((R=u.purchase)==null?void 0:R.purchase_code)||null),G=async()=>{const a={supplier_id:g.value,warehouse_id:x.value,products:r.value.map(t=>({purchase_item_id:t.purchase_item_id,product_id:t.id,quantity:+t.quantity,cost:t.cost,discount:t.discount??0,discounted_price:_(t),paid_amount:_(t)*t.quantity})),total_price:q.value,received_amount:P.value,purchase_code:k.value,payment_status:+w.value,order_status:0};B.put(route("purchases.update",u.purchase.id),a).then(t=>{var s,o;console.log(t),(s=t==null?void 0:t.data)!=null&&s.message?(localStorage.setItem("successMessage",t.data.message),window.location.href=route("admin.perches")):(o=t==null?void 0:t.data)!=null&&o.error&&h.error(t.data.error)}).catch(t=>{var s,o,F,I,M,$;(o=(s=t.response)==null?void 0:s.data)!=null&&o.errors?(console.log((I=(F=t.response)==null?void 0:F.data)==null?void 0:I.errors),Object.values(t.response.data.errors||{}).flat().forEach(W=>{h.error(W)})):($=(M=t.response)==null?void 0:M.data)!=null&&$.message?h.error(t.response.data.message):h.error("An unexpected error occurred."),console.log(t)})},H=async a=>{try{const t=await B.get(`/admin/search/${a}`);p.value=t.data,Array.isArray(p)?console.log("Products found:",p):console.log("Single product found:",p)}catch(t){t.response&&t.response.status===404?console.log(t.response.data.message):console.error("An error occurred:",t)}};z(()=>{const a=document.getElementById("dateInput"),t=new Date().toISOString().split("T")[0];a.value=t,j(()=>{Q("#perchesTable").DataTable({responsive:!0,scrollX:!0,scrollY:"300px",scrollCollapse:!0,paging:!0})})}),J(m,()=>{H(m.value)});const O=a=>{const t=r.value.find(s=>s.id===a.id);t?t.quantity+=1:r.value.push({...a,quantity:1}),j(()=>{Q("#perchesTable").DataTable().clear().rows.add(r.value).draw()})},N=a=>{r.value=r.value.filter(t=>t.id!==a)},C=(a,t)=>{const s=r.value.find(o=>o.id===a);s&&(s.quantity=Math.max(0,s.quantity+t))},L=a=>{a.discount<0?a.discount=0:a.discount>100&&(a.discount=100)},_=a=>{const t=a.discount??0,s=a.cost*t/100;return a.cost-s},q=K(()=>r.value.reduce((a,t)=>{const s=_(t);return a+s*t.quantity},0));return(a,t)=>(i(),Z(se,null,{default:ee(()=>[e("div",ae,[t[7]||(t[7]=e("div",{class:"col-sm-6"},[e("h4",{class:"mT-3"},"UPDATE PURCHASE")],-1)),e("div",oe,[e("ol",le,[e("li",ne,[e("a",{href:a.route("admin.dashboard")},"HOME",8,ie)]),e("li",de,[e("a",{href:a.route("admin.perches")},"PURCHASE",8,re)]),t[6]||(t[6]=e("li",{class:"breadcrumb-item active"},"UPDATE PURCHASE",-1))])])]),e("div",ue,[e("div",ce,[e("div",pe,[t[12]||(t[12]=e("div",{class:"col-lg-3 col-12"},[e("div",{class:"input-group mb-3"},[e("span",{class:"input-group-text",id:"basic-addon1"},[e("img",{src:"/images/icon/calendar.png",alt:"",width:"20px"})]),e("input",{type:"date",class:"form-control",placeholder:"Username","aria-label":"Username","aria-describedby":"basic-addon1",id:"dateInput",required:""})])],-1)),e("div",me,[e("div",ve,[t[9]||(t[9]=e("label",{class:"input-group-text",for:"inputGroupSelect01"},[e("img",{src:"/images/icon/user.png",alt:"",width:"20px"})],-1)),c(e("select",{class:"form-select",id:"inputGroupSelect01","onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s)},[t[8]||(t[8]=e("option",{value:"",disabled:""},"Select Supplier",-1)),(i(!0),d(b,null,y(f.suppliers,s=>(i(),d("option",{key:s.id,value:s.id},[e("span",null,n(s.first_name)+" Â "+n(s.last_name),1)],8,he))),128))],512),[[S,g.value]])])]),e("div",_e,[e("div",ye,[t[11]||(t[11]=e("label",{class:"input-group-text",for:"inputGroupSelect01"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),c(e("select",{class:"form-select",id:"inputGroupSelect01","onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s)},[t[10]||(t[10]=e("option",{value:"",disabled:""},"Select Warehouse",-1)),(i(!0),d(b,null,y(f.warehouses,s=>(i(),d("option",{key:s.id,value:s.id},n(s.name),9,be))),128))],512),[[S,x.value]])])])])])]),e("div",fe,[e("div",ge,[c(e("input",{class:"form-control",type:"text",placeholder:"Search Products...","aria-label":"default input example","onUpdate:modelValue":t[2]||(t[2]=s=>m.value=s)},null,512),[[v,m.value]]),m.value&&p.value.length>0?(i(),d("div",xe,[e("ul",null,[(i(!0),d(b,null,y(p.value,s=>(i(),d("li",{key:s.id,onClick:o=>O(s),class:"product-item",style:{cursor:"pointer"}},n(s.name)+" ("+n(s.code)+") - Rs "+n(s.cost),9,we))),128))])])):m.value&&p.value.length===0?(i(),d("div",Pe,t[13]||(t[13]=[e("p",null,"No products found...",-1)]))):te("",!0)])]),e("div",ke,[e("div",Se,[e("div",Ce,[t[16]||(t[16]=e("div",{class:"card-header card-header-background"},[e("h3",{class:"card-title"},"Purchase Details")],-1)),e("div",qe,[e("table",Te,[t[15]||(t[15]=e("thead",null,[e("tr",null,[e("th",{style:{width:"8%"}},"Product Code"),e("th",{style:{width:"8%"}},"Product name"),e("th",null,"Cost (Rs)"),e("th",null,"Discount (%)"),e("th",null,"Discount (Rs)"),e("th",{style:{width:"15%"}},"Quantity"),e("th",null,"Subtotal (Rs)"),e("th",{style:{"text-align":"center",width:"8%"}},"Action")])],-1)),e("tbody",null,[(i(!0),d(b,null,y(r.value,s=>(i(),d("tr",{key:s.id},[e("td",null,n(s.code),1),e("td",null,n(s.name),1),e("td",null,n(s.cost),1),e("td",null,[c(e("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>s.discount=o,min:"0",max:"100",onInput:o=>L(s),placeholder:"0"},null,40,Ue),[[v,s.discount]])]),e("td",null,n((s.discount/100*(s.quantity*s.cost)).toFixed(2)),1),e("td",null,[e("div",Ae,[e("div",De,[e("button",{class:"btn btn-primary",type:"button",onClick:o=>C(s.id,-1)}," - ",8,Ve),c(e("input",{class:"form-control","aria-label":"Quantity input","onUpdate:modelValue":o=>s.quantity=o,min:"1"},null,8,Ee),[[v,s.quantity]]),e("button",{class:"btn btn-primary",type:"button",onClick:o=>C(s.id,1)}," + ",8,Re)])])]),e("td",null,n((_(s)*s.quantity).toFixed(2)),1),e("td",Fe,[e("a",{onClick:o=>N(s.id),style:{cursor:"pointer"}},t[14]||(t[14]=[e("i",{class:"fas fa-solid fa-trash mr-4",style:{color:"#FF0000"}},null,-1)]),8,Ie)])]))),128))])])])])])]),e("div",Me,[e("div",$e,[e("div",je,[t[22]||(t[22]=e("div",{class:"card-header"},[e("h5",{class:"card-title fw-bold"},"Summery")],-1)),e("div",Be,[e("div",Qe,[e("div",Ge,[t[17]||(t[17]=e("label",{for:"quantity"},"Purchase Code :",-1)),c(e("input",{type:"text",class:"form-control",id:"purchase_code",placeholder:"Enter Product purchase code","onUpdate:modelValue":t[3]||(t[3]=s=>k.value=s)},null,512),[[v,k.value]]),t[18]||(t[18]=e("div",{class:"invalid-feedback"}," Please Provide Enter purchase code ",-1))])]),e("div",He,[t[19]||(t[19]=e("label",{for:"quantity"},"Balance :",-1)),e("div",Oe,[e("span",Ne,"Total: Rs "+n(q.value.toFixed(2)),1),c(e("input",{type:"number",class:"form-control",placeholder:"0.00","aria-label":"Recipient's username","aria-describedby":"basic-addon2","onUpdate:modelValue":t[4]||(t[4]=s=>P.value=s)},null,512),[[v,P.value]])])]),e("div",Le,[e("div",We,[t[21]||(t[21]=e("label",{for:"name"},"Payment Type",-1)),c(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":t[5]||(t[5]=s=>w.value=s)},t[20]||(t[20]=[e("option",{value:"",disabled:""},"Select Payment Type",-1),e("option",{value:"1"},"Cash",-1),e("option",{value:"3"},"Credit",-1)]),512),[[S,w.value]])])]),e("div",{class:"col-12 text-end"},[e("button",{class:"btn btn-success",onClick:G},"Save Purchase")])])])])])]),_:1}))}};export{ot as default};
