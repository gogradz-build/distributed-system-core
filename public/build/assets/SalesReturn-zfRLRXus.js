import{r as o,d as tt,f as et,n as st,k as lt,q as p,e as ot,o as r,l as at,h as nt,a as t,b as d,v as g,m as b,c as u,j as f,t as n,F as w}from"./app-C2i026LC.js";import{_ as it}from"./AdminLayout-DxRoeMN4.js";import{$ as rt}from"./dataTables.bootstrap4.min-73PbsmZ0.js";import"./AdminFooter-BK7-hYHZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const dt={class:"row mb-2"},ut={class:"col-sm-6"},ct={class:"breadcrumb float-sm-right mt-2"},mt={class:"breadcrumb-item"},vt=["href"],pt={class:"breadcrumb-item active"},_t=["href"],ht={class:"row mb-4"},yt={class:"col-12"},gt={class:"row d-flex justify-content-start"},bt={class:"col-lg-3 col-12"},ft={class:"input-group mb-3"},wt={class:"col-lg-3 col-12"},xt={class:"input-group mb-3"},St=["value"],qt={class:"col-lg-3 col-12"},Rt={class:"input-group mb-3"},kt=["value"],Ct={class:"col-lg-3 col-12"},Ut={class:"input-group mb-3"},Pt=["value"],Vt={class:"col-lg-3 col-12"},Dt={class:"input-group mb-3"},Et=["value"],Tt={class:"row",style:{"margin-top":"40px"}},It={class:"col-12"},Mt={class:"card card-primary"},$t={class:"card-body"},Bt={id:"perchesTable",class:"table table-hover"},At=["onUpdate:modelValue","onInput"],jt={class:"row d-flex"},Ft={class:"input-group quantity-group"},Qt=["onClick"],Gt=["onUpdate:modelValue"],Lt=["onClick"],Ot={class:"row d-flex"},Wt={class:"col-lg-8"},Ht={class:"card card-danger card-outline"},Nt={class:"card-body"},Xt={class:"col-lg-4"},Yt={class:"card card-danger card-outline"},zt={class:"card-body"},Jt={class:"col-12"},Kt={class:"input-group mb-3"},Zt={class:"input-group-text",id:"basic-addon2"},ne={__name:"SalesReturn",props:{sale:{type:Object,default:()=>({})}},setup(H){var M,$,B,A,j,F,Q;o(null);const c=tt(),P=o(""),x=o(""),_=o([]),V=o(0),i=H,h=o((((M=i.sale)==null?void 0:M.products)??[]).map(l=>({id:l.id,name:l.name,code:l.code,price:l.price,sellCount:l.sellCount,return_quantity:l.return_quantity,old_return_quantity:l.old_return_quantity||0,discount:l.discount,discounted_price:l.discounted_price||0,subtotal:l.subtotal,oldQuantity:l.oldQuantity}))),m=o((($=i.sale)==null?void 0:$.shop_id)||null),S=o(((B=i.sale)==null?void 0:B.ref_id)||null),y=o(((A=i.sale)==null?void 0:A.warehouse_id)||null);o(((j=i.sale)==null?void 0:j.order_status)||null);const q=o(((F=i.sale)==null?void 0:F.reason)||null),R=o(((Q=i.sale)==null?void 0:Q.payment_status)||3);o(""),o({});const N=async()=>{var s;E(m.value),U.value-(((s=i.sale)==null?void 0:s.receives_amount)||0);const l={warehouse_id:y.value,products:h.value.map(e=>({product_id:e.id,price:e.price,return_quantity:+e.return_quantity+e.old_return_quantity,discount:e.discount??0,subtotal:C(e)*e.quantity})),total_price:U.value,received_amount:V.value,payment_status:+R.value,shop_id:m.value,receives_amount:V.value,ref_id:S.value,reason:q.value};p.put(`/saleReturns/${i.sale.id}`,l).then(e=>{var a,v;console.log(e),(a=e==null?void 0:e.data)!=null&&a.message?(localStorage.setItem("successMessage",e.data.message),window.location.href=route("admin.sale.return")):(v=e==null?void 0:e.data)!=null&&v.error&&c.error(e.data.error)}).catch(e=>{var a,v,G,L,O,W;(v=(a=e.response)==null?void 0:a.data)!=null&&v.errors?(console.log((L=(G=e.response)==null?void 0:G.data)==null?void 0:L.errors),Object.values(e.response.data.errors||{}).flat().forEach(Z=>{c.error(Z)})):(W=(O=e.response)==null?void 0:O.data)!=null&&W.message?c.error(e.response.data.message):c.error("An unexpected error occurred."),console.log(e)})},X=async(l,s)=>{if(s.value==0)c.warning("Please Select Warehouse"),document.getElementById("warehouse").style.border="1px solid red";else{document.getElementById("warehouse").style.border="1px solid black !important";try{const e=await p.get(`/admin/search/${l}/${s}`);_.value=e.data,Array.isArray(_)?console.log("Products found:",_):console.log("Single product found:",_)}catch(e){e.response&&e.response.status===404?console.log(e.response.data.message):console.error("An error occurred:",e)}}};et(()=>{Y(),z(),K();const l=new Date().toISOString().split("T")[0];x.value=l,st(()=>{rt("#perchesTable").DataTable({responsive:!0,scrollX:!0,scrollY:"",scrollCollapse:!0,paging:!0})})}),lt(P,()=>{X(P.value,y.value)});const D=o([]),Y=async()=>{try{const l=await p.get("/warehouses");D.value=l.data}catch(l){console.error("Error fetching courses:",l)}},k=o([]),z=async()=>{try{const l=await p.get("/shops");k.value=l.data}catch(l){console.error("Error fetching courses:",l)}},E=l=>{const s=k.value.find(e=>e.id===l);return s?s.credit_limit-s.credit:0},T=(l,s)=>{const e=h.value.find(a=>a.id===l);e&&(e.return_quantity=Math.max(-e.old_return_quantity,e.return_quantity+s),e.return_quantity=Math.min(e.return_quantity,e.sellCount-e.old_return_quantity))},J=l=>{l.discount<0?l.discount=0:l.discount>100&&(l.discount=100)},C=l=>{const s=l.discount??0,e=l.price*s/100;return l.price-e},U=ot(()=>h.value.reduce((l,s)=>{const e=C(s);return l+e*s.return_quantity},0)),I=o([]),K=async()=>{try{const l=await p.get("/refs");I.value=l.data,console.log(l)}catch(l){console.error("Error fetching courses:",l)}};return(l,s)=>(r(),at(it,null,{default:nt(()=>[t("div",dt,[s[7]||(s[7]=t("div",{class:"col-sm-6"},[t("h4",{class:"mt-2"},"SALE RETURNS")],-1)),t("div",ut,[t("ol",ct,[t("li",mt,[t("a",{href:l.route("admin.dashboard")},"Home",8,vt)]),t("li",pt,[t("a",{href:l.route("admin.Sales")},"Sales",8,_t)]),s[6]||(s[6]=t("li",{class:"breadcrumb-item active"},"Sale Returns",-1))])])]),t("div",ht,[t("div",yt,[t("div",gt,[t("div",bt,[t("div",ft,[s[8]||(s[8]=t("span",{class:"input-group-text",id:"basic-addon1"},[t("img",{src:"/images/icon/calendar.png",alt:"",width:"20px"})],-1)),d(t("input",{type:"date",class:"form-control",placeholder:"Username","aria-label":"Username","onUpdate:modelValue":s[0]||(s[0]=e=>x.value=e),"aria-describedby":"basic-addon1",id:"dateInput",required:""},null,512),[[g,x.value]])])]),t("div",wt,[t("div",xt,[s[10]||(s[10]=t("label",{class:"input-group-text",for:"inputGroupSelect01"},[t("img",{src:"/images/icon/sale create warehouse.svg",alt:"",width:"20px"})],-1)),d(t("select",{class:"form-select",id:"warehouse","onUpdate:modelValue":s[1]||(s[1]=e=>y.value=e)},[s[9]||(s[9]=t("option",{selected:"",disabled:"",value:"0"},"Select WareHouse",-1)),(r(!0),u(w,null,f(D.value,e=>(r(),u("option",{key:e.id,value:e.id},n(e.name),9,St))),128))],512),[[b,y.value]])])]),t("div",qt,[t("div",Rt,[s[12]||(s[12]=t("label",{class:"input-group-text",for:"inputGroupSelect02"},[t("img",{src:"/images/icon/sale create store.svg",alt:"",width:"20px"})],-1)),d(t("select",{class:"form-select",id:"shop","onUpdate:modelValue":s[2]||(s[2]=e=>m.value=e)},[s[11]||(s[11]=t("option",{selected:"",disabled:"",value:"0"},"Select shop",-1)),(r(!0),u(w,null,f(k.value,e=>(r(),u("option",{key:e.id,value:e.id},n(e.name),9,kt))),128))],512),[[b,m.value]])])]),t("div",Ct,[t("div",Ut,[s[14]||(s[14]=t("label",{class:"input-group-text",for:"inputGroupSelect02"},[t("img",{src:"/images/icon/sale create  ref.svg",alt:"",width:"20px"})],-1)),d(t("select",{class:"form-select",id:"ref","onUpdate:modelValue":s[3]||(s[3]=e=>S.value=e)},[s[13]||(s[13]=t("option",{selected:"",disabled:"",value:"0"},"Select Ref",-1)),(r(!0),u(w,null,f(I.value,e=>(r(),u("option",{key:e.id,value:e.id},n(e.first_name),9,Pt))),128))],512),[[b,S.value]])])]),t("div",Vt,[t("div",Dt,[s[15]||(s[15]=t("label",{class:"input-group-text",for:"inputGroupSelect02"},[t("img",{src:"/images/icon/sales_payments.svg",alt:"",width:"20px"})],-1)),t("input",{type:"number",class:"form-control",id:"credit_limit",value:E(m.value),disabled:""},null,8,Et)])])])])]),t("div",Tt,[t("div",It,[t("div",Mt,[s[17]||(s[17]=t("div",{class:"card-header card-header-background"},[t("h3",{class:"card-title"},"Sales Items")],-1)),t("div",$t,[t("table",Bt,[s[16]||(s[16]=t("thead",null,[t("tr",null,[t("th",{style:{width:"20%"}},"Product Code"),t("th",{style:{width:"20%"}},"Product name"),t("th",null,"Price (Rs)"),t("th",null,"Discount (%)"),t("th",null,"Discount (Rs)"),t("th",{style:{width:"15%"}},"Quantity"),t("th",{style:{width:"15%"}},"Returned"),t("th",{style:{width:"15%"}},"Return"),t("th",null,"Subtotal (Rs)")])],-1)),t("tbody",null,[(r(!0),u(w,null,f(h.value,e=>(r(),u("tr",{key:e.id},[t("td",null,n(e.code),1),t("td",null,n(e.name),1),t("td",null,n(e.price),1),t("td",null,[d(t("input",{type:"number",class:"form-control","onUpdate:modelValue":a=>e.discount=a,min:"0",max:"100",onInput:a=>J(e),placeholder:"0"},null,40,At),[[g,e.discount]])]),t("td",null,n((C(e)*e.return_quantity).toFixed(2)),1),t("td",null,n(e.sellCount),1),t("td",null,n(e.old_return_quantity),1),t("td",null,[t("div",jt,[t("div",Ft,[t("button",{class:"btn btn-primary",type:"button",onClick:a=>T(e.id,-1)}," - ",8,Qt),d(t("input",{class:"form-control","aria-label":"Quantity input","onUpdate:modelValue":a=>e.return_quantity=a},null,8,Gt),[[g,e.return_quantity]]),t("button",{class:"btn btn-primary",type:"button",onClick:a=>T(e.id,1)}," + ",8,Lt)])])]),t("td",null,n((e.price*e.return_quantity).toFixed(2)),1)]))),128))])])])])])]),t("div",Ot,[t("div",Wt,[t("div",Ht,[s[18]||(s[18]=t("div",{class:"card-header"},[t("h5",{class:"card-title fw-bold"},"Reason")],-1)),t("div",Nt,[d(t("textarea",{class:"form-control","onUpdate:modelValue":s[4]||(s[4]=e=>q.value=e),rows:"3",placeholder:"Enter reason"},null,512),[[g,q.value]])])])]),t("div",Xt,[t("div",Yt,[s[21]||(s[21]=t("div",{class:"card-header"},[t("h5",{class:"card-title fw-bold"},"Summary")],-1)),t("div",zt,[t("div",Jt,[t("div",Kt,[t("span",Zt,"Total: Rs "+n(U.value.toFixed(2)),1)]),s[20]||(s[20]=t("label",{for:"payment_status"},"Payment Type",-1)),d(t("select",{class:"form-select","onUpdate:modelValue":s[5]||(s[5]=e=>R.value=e)},s[19]||(s[19]=[t("option",{value:"",disabled:""},"Select Payment Status",-1),t("option",{value:"1"},"Cash Returned",-1),t("option",{value:"3"},"By Credit",-1)]),512),[[b,R.value]])]),t("div",{class:"row mt-3"},[t("div",{class:"col-12 text-end"},[t("button",{class:"btn btn-success",onClick:N},"Return Sale")])])])])])])]),_:1}))}};export{ne as default};
