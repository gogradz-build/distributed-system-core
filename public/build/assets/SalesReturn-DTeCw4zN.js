import{r as a,e as K,f as Z,p as ee,j as te,n as v,i as se,o as i,g as oe,h as ae,a as e,d as r,v as h,k as g,c as d,l as y,t as n,F as w}from"./app-mDYLW31A.js";import{_ as le}from"./AdminLayout-UUPC1Aa5.js";import{$ as ne}from"./dataTables.bootstrap4.min-B2_zjVPS.js";import"side-channel-list";import"side-channel-map";import"side-channel-weakmap";import"./AdminFooter-BVWJI1Iq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"row mb-2"},re={class:"col-sm-6"},de={class:"breadcrumb float-sm-right"},ce={class:"breadcrumb-item"},ue=["href"],me={class:"breadcrumb-item active"},pe=["href"],ve={class:"row mb-4"},fe={class:"col-12"},be={class:"row d-flex justify-content-start"},_e={class:"col-lg-3 col-12"},he={class:"input-group mb-3"},ge={class:"col-lg-3 col-12"},ye={class:"input-group mb-3"},we=["value"],xe={class:"col-lg-3 col-12"},Se={class:"input-group mb-3"},ke=["value"],Ce={class:"col-lg-3 col-12"},Re={class:"input-group mb-3"},Pe=["value"],qe={class:"col-lg-3 col-12"},Ue={class:"input-group mb-3"},Ee=["value"],De={class:"row",style:{"margin-top":"80px"}},Te={class:"col-12"},Ve={class:"card card-primary"},Ae={class:"card-body"},Ie={id:"perchesTable",class:"table table-hover"},Me=["onUpdate:modelValue","onInput"],$e={class:"row d-flex"},Be={class:"input-group quantity-group"},Le=["onClick"],je=["onUpdate:modelValue"],Fe=["onClick"],Ne={class:"row d-flex justify-content-end"},Qe={class:"col-lg-4"},Ge={class:"card card-danger card-outline"},Oe={class:"card-body"},We={class:"col-12"},He={class:"input-group mb-3"},Xe={class:"input-group-text",id:"basic-addon2"},at={__name:"SalesReturn",props:{sale:{type:Object,default:()=>({})}},setup(G){var I,M,$,B,L;a(null);const u=K(),U=a(""),x=a(""),S=a(""),f=a([]),k=a(""),E=a(0),c=G,b=a((((I=c.sale)==null?void 0:I.products)??[]).map(o=>({id:o.id,name:o.name,code:o.code,price:o.price,sellCount:o.sellCount,return_quantity:o.return_quantity,discount:o.discount,discounted_price:o.discounted_price||0,subtotal:o.subtotal,oldQuantity:o.oldQuantity}))),m=a(((M=c.sale)==null?void 0:M.shop_id)||null),C=a((($=c.sale)==null?void 0:$.ref_id)||null),_=a(((B=c.sale)==null?void 0:B.warehouse_id)||null);a(((L=c.sale)==null?void 0:L.order_status)||null),a(""),a({});const O=async()=>{var s;T(m.value),q.value-(((s=c.sale)==null?void 0:s.receives_amount)||0);const o={warehouse_id:_.value,products:b.value.map(t=>({product_id:t.id,price:t.price,return_quantity:t.return_quantity,discount:t.discount??0,subtotal:P(t)*t.quantity})),total_price:q.value,received_amount:E.value,payment_status:+S.value,shop_id:m.value,receives_amount:E.value,ref_id:C.value,reason:k.value};v.put(`/saleReturns/${c.sale.id}`,o).then(t=>{var l,p;console.log(t),(l=t==null?void 0:t.data)!=null&&l.message?(localStorage.setItem("successMessage",t.data.message),window.location.href=route("admin.Sales")):(p=t==null?void 0:t.data)!=null&&p.error&&u.error(t.data.error)}).catch(t=>{var l,p,j,F,N,Q;(p=(l=t.response)==null?void 0:l.data)!=null&&p.errors?(console.log((F=(j=t.response)==null?void 0:j.data)==null?void 0:F.errors),Object.values(t.response.data.errors||{}).flat().forEach(J=>{u.error(J)})):(Q=(N=t.response)==null?void 0:N.data)!=null&&Q.message?u.error(t.response.data.message):u.error("An unexpected error occurred."),console.log(t)})},W=async(o,s)=>{if(s.value==0)u.warning("Please Select Warehouse"),document.getElementById("warehouse").style.border="1px solid red";else{document.getElementById("warehouse").style.border="1px solid black !important";try{const t=await v.get(`/admin/search/${o}/${s}`);f.value=t.data,Array.isArray(f)?console.log("Products found:",f):console.log("Single product found:",f)}catch(t){t.response&&t.response.status===404?console.log(t.response.data.message):console.error("An error occurred:",t)}}};Z(()=>{H(),X(),z();const o=new Date().toISOString().split("T")[0];x.value=o,ee(()=>{ne("#perchesTable").DataTable({responsive:!0,scrollX:!0,scrollY:"300px",scrollCollapse:!0,paging:!0})})}),te(U,()=>{W(U.value,_.value)});const D=a([]),H=async()=>{try{const o=await v.get("/warehouses");D.value=o.data}catch(o){console.error("Error fetching courses:",o)}},R=a([]),X=async()=>{try{const o=await v.get("/shops");R.value=o.data}catch(o){console.error("Error fetching courses:",o)}},T=o=>{const s=R.value.find(t=>t.id===o);return s?s.credit_limit-s.credit:0},V=(o,s)=>{const t=b.value.find(l=>l.id===o);t&&(t.return_quantity=Math.max(0,t.return_quantity+s))},Y=o=>{o.discount<0?o.discount=0:o.discount>100&&(o.discount=100)},P=o=>{const s=o.discount??0,t=o.price*s/100;return o.price-t},q=se(()=>b.value.reduce((o,s)=>{const t=P(s);return o+t*s.return_quantity},0)),A=a([]),z=async()=>{try{const o=await v.get("/refs");A.value=o.data,console.log(o)}catch(o){console.error("Error fetching courses:",o)}};return(o,s)=>(i(),oe(le,null,{default:ae(()=>[e("div",ie,[s[7]||(s[7]=e("div",{class:"col-sm-6"},[e("h4",{class:"mt-3"},"RETURN SALES")],-1)),e("div",re,[e("ol",de,[e("li",ce,[e("a",{href:o.route("admin.dashboard")},"HOME",8,ue)]),e("li",me,[e("a",{href:o.route("admin.Sales")},"SALES",8,pe)]),s[6]||(s[6]=e("li",{class:"breadcrumb-item active"},"RETURN SALES",-1))])])]),e("div",ve,[e("div",fe,[e("div",be,[e("div",_e,[e("div",he,[s[8]||(s[8]=e("span",{class:"input-group-text",id:"basic-addon1"},[e("img",{src:"/images/icon/calendar.png",alt:"",width:"20px"})],-1)),r(e("input",{type:"date",class:"form-control",placeholder:"Username","aria-label":"Username","onUpdate:modelValue":s[0]||(s[0]=t=>x.value=t),"aria-describedby":"basic-addon1",id:"dateInput",required:""},null,512),[[h,x.value]])])]),e("div",ge,[e("div",ye,[s[10]||(s[10]=e("label",{class:"input-group-text",for:"inputGroupSelect01"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),r(e("select",{class:"form-select",id:"warehouse","onUpdate:modelValue":s[1]||(s[1]=t=>_.value=t)},[s[9]||(s[9]=e("option",{selected:"",disabled:"",value:"0"},"Select WareHouse",-1)),(i(!0),d(w,null,y(D.value,t=>(i(),d("option",{key:t.id,value:t.id},n(t.name),9,we))),128))],512),[[g,_.value]])])]),e("div",xe,[e("div",Se,[s[12]||(s[12]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),r(e("select",{class:"form-select",id:"shop","onUpdate:modelValue":s[2]||(s[2]=t=>m.value=t)},[s[11]||(s[11]=e("option",{selected:"",disabled:"",value:"0"},"Select shop",-1)),(i(!0),d(w,null,y(R.value,t=>(i(),d("option",{key:t.id,value:t.id},n(t.name),9,ke))),128))],512),[[g,m.value]])])]),e("div",Ce,[e("div",Re,[s[14]||(s[14]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),r(e("select",{class:"form-select",id:"ref","onUpdate:modelValue":s[3]||(s[3]=t=>C.value=t)},[s[13]||(s[13]=e("option",{selected:"",disabled:"",value:"0"},"Select Ref",-1)),(i(!0),d(w,null,y(A.value,t=>(i(),d("option",{key:t.id,value:t.id},n(t.first_name),9,Pe))),128))],512),[[g,C.value]])])]),e("div",qe,[e("div",Ue,[s[15]||(s[15]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),e("input",{type:"number",class:"form-control",id:"credit_limit",value:T(m.value),disabled:""},null,8,Ee)])])])])]),e("div",De,[e("div",Te,[e("div",Ve,[s[17]||(s[17]=e("div",{class:"card-header card-header-background"},[e("h3",{class:"card-title"},"Sales Items")],-1)),e("div",Ae,[e("table",Ie,[s[16]||(s[16]=e("thead",null,[e("tr",null,[e("th",{style:{width:"8%"}},"Product Code"),e("th",{style:{width:"8%"}},"Product name"),e("th",null,"Price (Rs)"),e("th",null,"Discount (%)"),e("th",null,"Discount (Rs)"),e("th",{style:{width:"15%"}},"Quantity"),e("th",{style:{width:"15%"}},"Return"),e("th",null,"Subtotal (Rs)")])],-1)),e("tbody",null,[(i(!0),d(w,null,y(b.value,t=>(i(),d("tr",{key:t.id},[e("td",null,n(t.code),1),e("td",null,n(t.name),1),e("td",null,n(t.price),1),e("td",null,[r(e("input",{type:"number",class:"form-control","onUpdate:modelValue":l=>t.discount=l,min:"0",max:"100",onInput:l=>Y(t),placeholder:"0"},null,40,Me),[[h,t.discount]])]),e("td",null,n((P(t)*t.return_quantity).toFixed(2)),1),e("td",null,n(t.sellCount),1),e("td",null,[e("div",$e,[e("div",Be,[e("button",{class:"btn btn-primary",type:"button",onClick:l=>V(t.id,-1)}," - ",8,Le),r(e("input",{class:"form-control","aria-label":"Quantity input","onUpdate:modelValue":l=>t.return_quantity=l},null,8,je),[[h,t.return_quantity]]),e("button",{class:"btn btn-primary",type:"button",onClick:l=>V(t.id,1)}," + ",8,Fe)])])]),e("td",null,n((t.price*t.return_quantity).toFixed(2)),1)]))),128))])])])]),r(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=t=>k.value=t)},null,512),[[h,k.value]])])]),e("div",Ne,[e("div",Qe,[e("div",Ge,[s[20]||(s[20]=e("div",{class:"card-header"},[e("h5",{class:"card-title fw-bold"},"Summary")],-1)),e("div",Oe,[e("div",We,[e("div",He,[e("span",Xe,"Total: Rs "+n(q.value.toFixed(2)),1)]),s[19]||(s[19]=e("label",{for:"name"},"Payment Type",-1)),r(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":s[5]||(s[5]=t=>S.value=t)},s[18]||(s[18]=[e("option",{value:"",disabled:""},"Select Payment Status",-1),e("option",{value:"1"},"Cash Return",-1),e("option",{value:"2"},"Pending",-1),e("option",{value:"3"},"By Credit",-1)]),512),[[g,S.value]])]),e("div",{class:"row"},[e("div",{class:"col-12 text-end"},[e("button",{class:"btn btn-success",onClick:O},"Return Sale")])])])])])]),s[21]||(s[21]=e("div",{class:"offcanvas offcanvas-end","data-bs-scroll":"true","data-bs-backdrop":"false",tabindex:"-1",id:"offcanvasScrolling","aria-labelledby":"offcanvasScrollingLabel"},[e("div",{class:"offcanvas-header"},[e("h5",{class:"offcanvas-title",id:"offcanvasScrollingLabel"},"Category Name"),e("button",{type:"button",class:"btn-close text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"})]),e("div",{class:"offcanvas-body"},[e("div",{class:"row"},[e("div",{class:"container result_container"},[e("input",{class:"form-control",type:"text",placeholder:"Search Products...","aria-label":"default input example"}),e("div",{class:"search-result"},[e("p",null,"456 product")])])]),e("div",{class:"row mt-4"},[e("div",{class:"col-12"}," Product Name (Code) ")])])],-1))]),_:1}))}};export{at as default};
