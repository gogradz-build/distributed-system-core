import{Q as O,d as Q,r as l,f as N,n as H,k as W,q as _,e as L,o as i,l as X,h as Y,a as e,b as d,m as g,c as r,j as y,t as n,F as b,v as m,s as z}from"./app-C2i026LC.js";import{_ as J}from"./AdminLayout-DxRoeMN4.js";import{$ as K}from"./dataTables.bootstrap4.min-73PbsmZ0.js";import"./Delta-CMnuj_9_.js";/* empty css                       */import"./AdminFooter-BK7-hYHZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"row mb-2"},ee={class:"col-sm-6"},te={class:"breadcrumb float-sm-right mt-2"},se={class:"breadcrumb-item"},oe=["href"],ae={class:"breadcrumb-item active"},le=["href"],ne={class:"row mb-4"},ie={class:"col-12"},re={class:"row d-flex justify-content-center"},de={class:"col-lg-3 col-12"},ce={class:"input-group mb-3"},ue=["value"],pe={class:"col-lg-3 col-12"},me={class:"input-group mb-3"},ve=["value"],he={class:"row"},_e={class:"container result_container"},ge={class:"input-group mb-3"},ye={key:0,class:"search-result",id:"search_result"},be={class:"product-list"},fe=["onClick"],we={key:1,class:"search-result"},xe={class:"row mt-4"},Pe={class:"col-12"},Se={class:"card card-primary"},ke={class:"card-body"},Ce={id:"perchesTable",class:"table table-hover"},qe=["onUpdate:modelValue","onInput"],Te={class:"row d-flex"},Ue={class:"input-group quantity-group"},De=["onClick"],Ve=["onUpdate:modelValue"],Ee=["onClick"],Ie={class:"justify-content-center align-items-center"},Ae=["onClick"],Re={class:"row d-flex justify-content-end"},$e={class:"col-lg-4"},Be={class:"card card-success card-outline"},Me={class:"card-body"},je={class:"col-lg-12"},Fe={class:"form-group"},Ge={class:"col-12"},Oe={class:"input-group mb-3"},Qe={class:"input-group-text",id:"basic-addon2"},Ne={class:"col-12"},He={class:"form-group"},We={class:"col-12"},Le={class:"form-group"},ot={__name:"CreatePerches",setup(Xe){O();const v=Q();l(null),l(0);const f=l(0),u=l(""),w=l(""),x=l(""),P=l(""),S=l(""),k=l(""),p=l(""),c=l([]);l({code:"",name:"",cost:"",image:"",description:"",variation_id:"",category_id:""});const A=async()=>{const o={supplier_id:w.value,warehouse_id:x.value,products:c.value.map(t=>({product_id:t.id,quantity:+t.quantity,cost:t.cost,discount:t.discount??0,discounted_price:h(t),paid_amount:h(t)*t.quantity})),total_price:U.value,received_amount:f.value,payment_status:+P.value,purchase_code:k.value,order_status:S.value};_.post("/purchases",o).then(t=>{var s,a;console.log(t),(s=t==null?void 0:t.data)!=null&&s.message?(localStorage.setItem("successMessage",t.data.message),window.location.href=route("admin.perches")):(a=t==null?void 0:t.data)!=null&&a.error&&v.error(t.data.error)}).catch(t=>{var s,a,D,V,E,I;(a=(s=t.response)==null?void 0:s.data)!=null&&a.errors?(console.log((V=(D=t.response)==null?void 0:D.data)==null?void 0:V.errors),Object.values(t.response.data.errors||{}).flat().forEach(G=>{v.error(G)})):(I=(E=t.response)==null?void 0:E.data)!=null&&I.message?v.error(t.response.data.message):v.error("An unexpected error occurred."),console.log(t)})},R=async o=>{try{const t=await _.get(`/admin/search/${o}`);p.value=t.data,Array.isArray(p)?console.log("Products found:",p):console.log("Single product found:",p)}catch(t){t.response&&t.response.status===404?console.log(t.response.data.message):console.error("An error occurred:",t)}};N(()=>{B(),$();const o=document.getElementById("dateInput"),t=new Date().toISOString().split("T")[0];o.value=t,H(()=>{K("#perchesTable").DataTable({responsive:!0,scrollX:!0,scrollY:"",scrollCollapse:!0,paging:!0})})}),W(u,()=>{R(u.value)});const C=l([]),$=async()=>{try{const o=await _.get("/suppliers");C.value=o.data,console.log(o)}catch(o){console.error("Error fetching courses:",o)}},q=l([]),B=async()=>{try{const o=await _.get("/warehouses");q.value=o.data}catch(o){console.error("Error fetching courses:",o)}},M=o=>{const t=c.value.find(s=>s.id===o.id);t?t.quantity+=1:c.value.push({...o,quantity:1}),u.value="",document.getElementById("search_result").style.display="none"},j=o=>{c.value=c.value.filter(t=>t.id!==o)},T=(o,t)=>{const s=c.value.find(a=>a.id===o);s&&(s.quantity=Math.max(1,s.quantity+t))},F=o=>{o.discount<0?o.discount=0:o.discount>100&&(o.discount=100)},h=o=>{const t=o.discount??0,s=o.cost*t/100;return o.cost-s},U=L(()=>c.value.reduce((o,t)=>{const s=h(t);return o+s*t.quantity},0));return(o,t)=>(i(),X(J,null,{default:Y(()=>[e("div",Z,[t[8]||(t[8]=e("div",{class:"col-sm-6"},[e("h4",{class:"mt-2"},"CREATE PURCHASE")],-1)),e("div",ee,[e("ol",te,[e("li",se,[e("a",{href:o.route("admin.dashboard")},"Home",8,oe)]),e("li",ae,[e("a",{href:o.route("admin.perches")},"Purchase",8,le)]),t[7]||(t[7]=e("li",{class:"breadcrumb-item active"},"Create Purchase",-1))])])]),e("div",ne,[e("div",ie,[e("div",re,[t[13]||(t[13]=e("div",{class:"col-lg-3 col-12"},[e("div",{class:"input-group mb-3"},[e("span",{class:"input-group-text",id:"basic-addon1"},[e("img",{src:"/images/icon/calendar.svg",alt:"",width:"20px"})]),e("input",{type:"date",class:"form-control",placeholder:"Username","aria-label":"Username","aria-describedby":"basic-addon1",id:"dateInput",required:""})])],-1)),e("div",de,[e("div",ce,[t[10]||(t[10]=e("label",{class:"input-group-text",for:"inputGroupSelect01"},[e("img",{src:"/images/icon/purchase supplier.svg",alt:"",width:"20px"})],-1)),d(e("select",{class:"form-select",id:"inputGroupSelect01","onUpdate:modelValue":t[0]||(t[0]=s=>w.value=s)},[t[9]||(t[9]=e("option",{value:"",disabled:""},"Select Supplier",-1)),(i(!0),r(b,null,y(C.value,s=>(i(),r("option",{key:s.id,value:s.id},[e("span",null,n(s.first_name)+" Â "+n(s.last_name),1)],8,ue))),128))],512),[[g,w.value]])])]),e("div",pe,[e("div",me,[t[12]||(t[12]=e("label",{class:"input-group-text",for:"inputGroupSelect01"},[e("img",{src:"/images/icon/sale create warehouse.svg",alt:"",width:"20px"})],-1)),d(e("select",{class:"form-select",id:"inputGroupSelect01","onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s)},[t[11]||(t[11]=e("option",{value:"",disabled:""},"Select Warehouse",-1)),(i(!0),r(b,null,y(q.value,s=>(i(),r("option",{key:s.id,value:s.id},n(s.name),9,ve))),128))],512),[[g,x.value]])])])])])]),e("div",he,[e("div",_e,[e("div",ge,[t[14]||(t[14]=e("label",{class:"input-group-text",for:"inputGroupSelect01"},[e("img",{src:"/images/icon/search.svg",alt:"",width:"20px"})],-1)),d(e("input",{class:"form-control",type:"text",placeholder:"Search Products...","aria-label":"default input example","onUpdate:modelValue":t[2]||(t[2]=s=>u.value=s),id:"search-input"},null,512),[[m,u.value]])]),u.value&&p.value.length>0?(i(),r("div",ye,[e("ol",be,[(i(!0),r(b,null,y(p.value,s=>(i(),r("li",{key:s.id,onClick:a=>M(s),class:"product-item",style:{cursor:"pointer"}},n(s.name)+" ("+n(s.code)+") - Rs "+n(s.cost),9,fe))),128))])])):u.value&&p.value.length===0?(i(),r("div",we,t[15]||(t[15]=[e("p",null,"No products found...",-1)]))):z("",!0)])]),e("div",xe,[e("div",Pe,[e("div",Se,[t[18]||(t[18]=e("div",{class:"card-header card-header-background"},[e("h3",{class:"card-title"},"Purchase Details")],-1)),e("div",ke,[e("table",Ce,[t[17]||(t[17]=e("thead",null,[e("tr",null,[e("th",{style:{width:"20%"}},"Product Code"),e("th",{style:{width:"25%"}},"Product name"),e("th",{style:{width:"10%"}},"Price (Rs)"),e("th",{style:{width:"10%"}},"Discount (%)"),e("th",{style:{width:"10%"}},"Discount (Rs)"),e("th",{style:{width:"10%"}},"Quantity"),e("th",{style:{width:"10%"}},"Subtotal (Rs)"),e("th",{style:{"text-align":"center",width:"8%"}},"Action")])],-1)),e("tbody",null,[(i(!0),r(b,null,y(c.value,s=>(i(),r("tr",{key:s.id},[e("td",null,n(s.code),1),e("td",null,n(s.name),1),e("td",null,n(s.cost),1),e("td",null,[d(e("input",{type:"number",class:"form-control","onUpdate:modelValue":a=>s.discount=a,min:"0",max:"100",onInput:a=>F(s),placeholder:"0"},null,40,qe),[[m,s.discount]])]),e("td",null,n((s.discount/100*(s.quantity*s.cost)).toFixed(2)),1),e("td",null,[e("div",Te,[e("div",Ue,[e("button",{class:"btn btn-primary",type:"button",onClick:a=>T(s.id,-1)}," - ",8,De),d(e("input",{class:"form-control","aria-label":"Quantity input","onUpdate:modelValue":a=>s.quantity=a,min:"1"},null,8,Ve),[[m,s.quantity]]),e("button",{class:"btn btn-primary",type:"button",onClick:a=>T(s.id,1)}," + ",8,Ee)])])]),e("td",null,n((h(s)*s.quantity).toFixed(2)),1),e("td",Ie,[e("a",{onClick:a=>j(s.id),style:{cursor:"pointer"}},t[16]||(t[16]=[e("img",{src:"/images/icon/trash-bin.png",alt:"",width:"25px",height:"25px",class:"table-action-icon"},null,-1)]),8,Ae)])]))),128))])])])])])]),e("div",Re,[e("div",$e,[e("div",Be,[t[26]||(t[26]=e("div",{class:"card-header"},[e("h5",{class:"card-title fw-bold"},"Summery")],-1)),e("div",Me,[e("div",je,[e("div",Fe,[t[19]||(t[19]=e("label",{for:"quantity"},"Purchase Code :",-1)),d(e("input",{type:"text",class:"form-control",id:"purchase_code",placeholder:"Enter Product purchase code","onUpdate:modelValue":t[3]||(t[3]=s=>k.value=s)},null,512),[[m,k.value]]),t[20]||(t[20]=e("div",{class:"invalid-feedback"}," Please Provide Enter purchase code ",-1))])]),e("div",Ge,[t[21]||(t[21]=e("label",{for:"quantity"},"Balance :",-1)),e("div",Oe,[e("span",Qe,"Total: Rs "+n(U.value.toFixed(2)),1),d(e("input",{type:"number",class:"form-control",placeholder:"0.00","aria-label":"Recipient's username","aria-describedby":"basic-addon2","onUpdate:modelValue":t[4]||(t[4]=s=>f.value=s)},null,512),[[m,f.value]])])]),e("div",Ne,[e("div",He,[t[23]||(t[23]=e("label",{for:"name"},"Payment Type",-1)),d(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":t[5]||(t[5]=s=>P.value=s)},t[22]||(t[22]=[e("option",{value:"",disabled:""},"Select Payment Type",-1),e("option",{value:"1"},"Cash",-1),e("option",{value:"3"},"Credit",-1)]),512),[[g,P.value]])])]),e("div",We,[e("div",Le,[t[25]||(t[25]=e("label",{for:"name"},"Order Status",-1)),d(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":t[6]||(t[6]=s=>S.value=s)},t[24]||(t[24]=[e("option",{value:"",disabled:""},"Select Order Status",-1),e("option",{value:"1"},"Pending",-1),e("option",{value:"2"},"Confirmed",-1),e("option",{value:"3"},"Delivered",-1)]),512),[[g,S.value]])])]),e("div",{class:"col-12 text-end"},[e("button",{class:"btn btn-success",onClick:A},"Save Purchase")])])])])])]),_:1}))}};export{ot as default};
