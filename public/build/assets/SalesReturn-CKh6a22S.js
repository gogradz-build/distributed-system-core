import{r as a,e as ee,f as te,p as se,j as le,n as f,i as oe,o as i,g as ae,h as ne,a as e,d as r,v as g,k as S,c as u,l as C,t as d,F as k}from"./app-JnpFVuSp.js";import{_ as ie}from"./AdminLayout-CP0E-03s.js";import{$ as re}from"./dataTables.bootstrap4.min-DdNG8ZfS.js";import"./AdminFooter-CrMPERQ2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"row mb-2"},ce={class:"col-sm-6"},ue={class:"breadcrumb float-sm-right"},me={class:"breadcrumb-item"},ve=["href"],pe={class:"breadcrumb-item active"},be=["href"],fe={class:"row mb-4"},ge={class:"col-12"},he={class:"row d-flex justify-content-start"},_e={class:"col-lg-3 col-12"},ye={class:"input-group mb-3"},xe={class:"col-lg-3 col-12"},we={class:"input-group mb-3"},Se=["value"],Ce={class:"col-lg-3 col-12"},ke={class:"input-group mb-3"},Re=["value"],Ue={class:"col-lg-3 col-12"},Pe={class:"input-group mb-3"},Ee=["value"],Ve={class:"col-lg-3 col-12"},De={class:"input-group mb-3"},Te=["value"],Ae={class:"row",style:{"margin-top":"80px"}},Ie={class:"col-12"},Me={class:"card card-primary"},$e={class:"card-body"},Le={id:"perchesTable",class:"table table-hover"},Qe=["onUpdate:modelValue","onInput"],je={class:"row d-flex"},Be={class:"input-group quantity-group"},Fe=["onClick"],Ne=["onUpdate:modelValue"],qe=["onClick"],Ge={class:"row d-flex justify-content-end"},Oe={class:"col-lg-4"},We={class:"card card-danger card-outline"},He={class:"card-body"},Xe={class:"col-12"},Ye={class:"input-group mb-3"},ze={class:"input-group-text",id:"basic-addon2"},lt={__name:"SalesReturn",props:{sale:{type:Object,default:()=>({})}},setup(T){var Q,j,B,F,N;a(null);const m=ee();a(0);const A=a(""),h=a(""),R=a(""),_=a([]),U=a(""),y=a(0),c=T,x=a((((Q=c.sale)==null?void 0:Q.products)??[]).map(l=>({id:l.id,name:l.name,code:l.code,price:l.price,sellCount:l.sellCount,discount:l.discount,discounted_price:l.discounted_price||0,subtotal:l.subtotal,oldQuantity:l.oldQuantity}))),v=a(((j=c.sale)==null?void 0:j.shop_id)||null),P=a(((B=c.sale)==null?void 0:B.ref_id)||null),w=a(((F=c.sale)==null?void 0:F.warehouse_id)||null);a(((N=c.sale)==null?void 0:N.order_status)||null),a(""),a({});const H=async()=>{var s,n;const l=M(v.value);D.value-(((s=c.sale)==null?void 0:s.receives_total)||0);const t={warehouse_id:w.value,products:x.value.map(o=>({product_id:o.id,quantity:+o.sellCount,oldQuantity:+o.oldQuantity,price:o.price,discount:o.discount??0,subtotal:V(o)*o.quantity})),total_price:D.value-((n=c.sale)==null?void 0:n.receives_total),sub_total:y.value,payment_status:+R.value,todyDate:h.value,shop_id:v.value,receives_total:y.value,ref_id:P.value,credit:l,reason:U.value};f.put(`/saleReturns/${c.sale.id}`,t).then(o=>{var p,b;console.log(o),(p=o==null?void 0:o.data)!=null&&p.message?(localStorage.setItem("successMessage",o.data.message),window.location.href=route("admin.Sales")):(b=o==null?void 0:o.data)!=null&&b.error&&m.error(o.data.error)}).catch(o=>{var p,b,q,G,O,W;(b=(p=o.response)==null?void 0:p.data)!=null&&b.errors?(console.log((G=(q=o.response)==null?void 0:q.data)==null?void 0:G.errors),Object.values(o.response.data.errors||{}).flat().forEach(Z=>{m.error(Z)})):(W=(O=o.response)==null?void 0:O.data)!=null&&W.message?m.error(o.response.data.message):m.error("An unexpected error occurred."),console.log(o)})},X=async(l,t)=>{if(t.value==0)m.warning("Please Select Warehouse"),document.getElementById("warehouse").style.border="1px solid red";else{document.getElementById("warehouse").style.border="1px solid black !important";try{const s=await f.get(`/admin/search/${l}/${t}`);_.value=s.data,Array.isArray(_)?console.log("Products found:",_):console.log("Single product found:",_)}catch(s){s.response&&s.response.status===404?console.log(s.response.data.message):console.error("An error occurred:",s)}}};te(()=>{Y(),z(),K();const l=new Date().toISOString().split("T")[0];h.value=l,se(()=>{re("#perchesTable").DataTable({responsive:!0,scrollX:!0,scrollY:"300px",scrollCollapse:!0,paging:!0})})}),le(A,()=>{X(A.value,w.value)});const I=a([]),Y=async()=>{try{const l=await f.get("/warehouses");I.value=l.data}catch(l){console.error("Error fetching courses:",l)}},E=a([]),z=async()=>{try{const l=await f.get("/shops");E.value=l.data}catch(l){console.error("Error fetching courses:",l)}},M=l=>{const t=E.value.find(s=>s.id===l);return t?t.credit_limit-t.credit:0},$=(l,t)=>{const s=x.value.find(n=>n.id===l);s&&(s.sellCount=Math.max(1,s.sellCount+t))},J=l=>{l.discount<0?l.discount=0:l.discount>100&&(l.discount=100)},V=l=>{const t=l.discount??0,s=l.price*t/100;return l.price-s},D=oe(()=>x.value.reduce((l,t,s)=>{const n=V(t);return n*t.sellCount-s.receives_total,l+n*t.sellCount},0)),L=a([]),K=async()=>{try{const l=await f.get("/refs");L.value=l.data,console.log(l)}catch(l){console.error("Error fetching courses:",l)}};return(l,t)=>(i(),ae(ie,null,{default:ne(()=>[e("div",de,[t[8]||(t[8]=e("div",{class:"col-sm-6"},[e("h4",{class:"mt-3"},"RETURN SALES")],-1)),e("div",ce,[e("ol",ue,[e("li",me,[e("a",{href:l.route("admin.dashboard")},"HOME",8,ve)]),e("li",pe,[e("a",{href:l.route("admin.Sales")},"SALES",8,be)]),t[7]||(t[7]=e("li",{class:"breadcrumb-item active"},"RETURN SALES",-1))])])]),e("div",fe,[e("div",ge,[e("div",he,[e("div",_e,[e("div",ye,[t[9]||(t[9]=e("span",{class:"input-group-text",id:"basic-addon1"},[e("img",{src:"/images/icon/calendar.png",alt:"",width:"20px"})],-1)),r(e("input",{type:"date",class:"form-control",placeholder:"Username","aria-label":"Username","onUpdate:modelValue":t[0]||(t[0]=s=>h.value=s),"aria-describedby":"basic-addon1",id:"dateInput",required:""},null,512),[[g,h.value]])])]),e("div",xe,[e("div",we,[t[11]||(t[11]=e("label",{class:"input-group-text",for:"inputGroupSelect01"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),r(e("select",{class:"form-select",id:"warehouse","onUpdate:modelValue":t[1]||(t[1]=s=>w.value=s)},[t[10]||(t[10]=e("option",{selected:"",disabled:"",value:"0"},"Select WareHouse",-1)),(i(!0),u(k,null,C(I.value,s=>(i(),u("option",{key:s.id,value:s.id},d(s.name),9,Se))),128))],512),[[S,w.value]])])]),e("div",Ce,[e("div",ke,[t[13]||(t[13]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),r(e("select",{class:"form-select",id:"shop","onUpdate:modelValue":t[2]||(t[2]=s=>v.value=s)},[t[12]||(t[12]=e("option",{selected:"",disabled:"",value:"0"},"Select shop",-1)),(i(!0),u(k,null,C(E.value,s=>(i(),u("option",{key:s.id,value:s.id},d(s.name),9,Re))),128))],512),[[S,v.value]])])]),e("div",Ue,[e("div",Pe,[t[15]||(t[15]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),r(e("select",{class:"form-select",id:"ref","onUpdate:modelValue":t[3]||(t[3]=s=>P.value=s)},[t[14]||(t[14]=e("option",{selected:"",disabled:"",value:"0"},"Select Ref",-1)),(i(!0),u(k,null,C(L.value,s=>(i(),u("option",{key:s.id,value:s.id},d(s.first_name),9,Ee))),128))],512),[[S,P.value]])])]),e("div",Ve,[e("div",De,[t[16]||(t[16]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),e("input",{type:"number",class:"form-control",id:"credit_limit",value:M(v.value),disabled:""},null,8,Te)])])])])]),e("div",Ae,[e("div",Ie,[e("div",Me,[t[18]||(t[18]=e("div",{class:"card-header card-header-background"},[e("h3",{class:"card-title"},"Sales Items")],-1)),e("div",$e,[e("table",Le,[t[17]||(t[17]=e("thead",null,[e("tr",null,[e("th",{style:{width:"8%"}},"Product Code"),e("th",{style:{width:"8%"}},"Product name"),e("th",null,"Price (Rs)"),e("th",null,"Discount (%)"),e("th",null,"Discount (Rs)"),e("th",{style:{width:"15%"}},"Quantity"),e("th",null,"Subtotal (Rs)")])],-1)),e("tbody",null,[(i(!0),u(k,null,C(x.value,s=>(i(),u("tr",{key:s.id},[e("td",null,d(s.code),1),e("td",null,d(s.name),1),e("td",null,d(s.price),1),e("td",null,[r(e("input",{type:"number",class:"form-control","onUpdate:modelValue":n=>s.discount=n,min:"0",max:"100",onInput:n=>J(s),placeholder:"0"},null,40,Qe),[[g,s.discount]])]),e("td",null,d((V(s)*s.sellCount).toFixed(2)),1),e("td",null,[e("div",je,[e("div",Be,[e("button",{class:"btn btn-primary",type:"button",onClick:n=>$(s.id,-1)}," - ",8,Fe),r(e("input",{class:"form-control","aria-label":"Quantity input","onUpdate:modelValue":n=>s.sellCount=n,min:"1"},null,8,Ne),[[g,s.sellCount]]),e("button",{class:"btn btn-primary",type:"button",onClick:n=>$(s.id,1),disabled:""}," + ",8,qe)])])]),e("td",null,d((s.price*s.sellCount).toFixed(2)),1)]))),128))])])])]),r(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=s=>U.value=s)},null,512),[[g,U.value]])])]),e("div",Ge,[e("div",Oe,[e("div",We,[t[21]||(t[21]=e("div",{class:"card-header"},[e("h5",{class:"card-title fw-bold"},"Summary")],-1)),e("div",He,[e("div",Xe,[e("div",Ye,[e("span",ze,"Total: Rs "+d(D.value.toFixed(2)-T.sale.receives_total),1),r(e("input",{type:"number",class:"form-control",placeholder:"0.00","aria-label":"Recipient's username","aria-describedby":"basic-addon2","onUpdate:modelValue":t[5]||(t[5]=s=>y.value=s)},null,512),[[g,y.value]])]),t[20]||(t[20]=e("label",{for:"name"},"Payment Type",-1)),r(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":t[6]||(t[6]=s=>R.value=s)},t[19]||(t[19]=[e("option",{value:"",disabled:""},"Select Payment Type",-1),e("option",{value:"1"},"Cash",-1),e("option",{value:"3"},"Credit",-1)]),512),[[S,R.value]])]),e("div",{class:"row"},[e("div",{class:"col-12 text-end"},[e("button",{class:"btn btn-success",onClick:H},"Return Sale")])])])])])]),t[22]||(t[22]=e("div",{class:"offcanvas offcanvas-end","data-bs-scroll":"true","data-bs-backdrop":"false",tabindex:"-1",id:"offcanvasScrolling","aria-labelledby":"offcanvasScrollingLabel"},[e("div",{class:"offcanvas-header"},[e("h5",{class:"offcanvas-title",id:"offcanvasScrollingLabel"},"Category Name"),e("button",{type:"button",class:"btn-close text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"})]),e("div",{class:"offcanvas-body"},[e("div",{class:"row"},[e("div",{class:"container result_container"},[e("input",{class:"form-control",type:"text",placeholder:"Search Products...","aria-label":"default input example"}),e("div",{class:"search-result"},[e("p",null,"456 product")])])]),e("div",{class:"row mt-4"},[e("div",{class:"col-12"}," Product Name (Code) ")])])],-1))]),_:1}))}};export{lt as default};
