import{Q as L,e as W,r as l,f as X,p as Y,j as z,i as J,o as d,g as K,h as Z,a as t,d as r,k as P,c as u,l as q,t as n,F as U,v as b,n as $}from"./app-mDYLW31A.js";import{_ as tt}from"./AdminLayout-UUPC1Aa5.js";import{$ as et}from"./dataTables.bootstrap4.min-B2_zjVPS.js";import"./vue-quill.snow-BON5O7Yn.js";import"side-channel-list";import"side-channel-map";import"side-channel-weakmap";import"./AdminFooter-BVWJI1Iq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const st={class:"row mb-2"},at={class:"col-sm-6"},ot={class:"breadcrumb float-sm-right"},lt={class:"breadcrumb-item"},nt=["href"],it={class:"breadcrumb-item active"},dt=["href"],rt={class:"row mb-4"},ut={class:"col-12"},ct={class:"row d-flex justify-content-center"},mt={class:"col-lg-3 col-12"},pt={class:"input-group mb-3"},vt=["value"],ht={class:"col-lg-3 col-12"},yt={class:"input-group mb-3"},_t=["value"],bt={class:"row mt-4"},ft={class:"col-12"},gt={class:"card card-primary"},xt={class:"card-body"},wt={id:"perchesTable",class:"table table-hover"},St=["onUpdate:modelValue","onInput"],Pt={class:"row d-flex"},qt={class:"input-group quantity-group"},Ut=["onClick"],Rt=["onUpdate:modelValue"],kt=["onClick"],Ct={class:"card-header"},Tt={class:"row d-flex justify-content-end"},At={class:"col-lg-4"},Dt={class:"card card-info card-outline"},Vt={class:"card-body"},Et={class:"col-12"},It={class:"input-group mb-3"},Mt={class:"input-group-text",id:"basic-addon2"},Qt={class:"col-12"},jt={class:"form-group"},Yt={__name:"purchaseReturn",props:{purchase:{type:Object,default:()=>({})},suppliers:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},products:{type:Array,default:()=>[]}},setup(p){var T,A,D,V,E;L();const v=W();l(null),l(0);const f=l(0),g=l(""),R=l(""),h=l("");l({code:"",name:"",cost:"",price:"",image:"",description:"",variation_id:"",category_id:""});const i=p,y=l((((T=i.purchase)==null?void 0:T.products)??[]).map(o=>({id:o.product_id,name:o.name,code:o.code,cost:o.cost,quantity:o.quantity,discount:o.discount,discounted_price:o.discounted_price||0,subtotal:o.subtotal,oldQuantity:o.oldQuantity}))),x=l(((A=i.purchase)==null?void 0:A.supplier_id)||null),w=l(((D=i.purchase)==null?void 0:D.warehouse_id)||null),S=l(((V=i.purchase)==null?void 0:V.payment_status)||null),B=l(((E=i.purchase)==null?void 0:E.order_status)||null),F=async()=>{var s;const o=C.value-(((s=i.purchase)==null?void 0:s.receives_total)||0),e={supplier_id:x.value,warehouse_id:w.value,products:y.value.map(a=>({product_id:a.id,quantity:+a.quantity,cost:a.cost,discount:a.discount??0,discounted_price:_(a),oldQuantity:a.oldQuantity,paid_amount:_(a)*a.quantity})),total_price:o,receives_total:f.value,payment_status:+S.value,order_status:+B.value,reason:g.value};$.put(`/returnPurchases/${i.purchase.id}`,e).then(a=>{var c,m;console.log(a),(c=a==null?void 0:a.data)!=null&&c.message?(localStorage.setItem("successMessage",a.data.message),window.location.href=route("admin.perches")):(m=a==null?void 0:a.data)!=null&&m.error&&v.error(a.data.error)}).catch(a=>{var c,m,I,M,Q,j;(m=(c=a.response)==null?void 0:c.data)!=null&&m.errors?(console.log((M=(I=a.response)==null?void 0:I.data)==null?void 0:M.errors),Object.values(a.response.data.errors||{}).flat().forEach(N=>{v.error(N)})):(j=(Q=a.response)==null?void 0:Q.data)!=null&&j.message?v.error(a.response.data.message):v.error("An unexpected error occurred."),console.log(a)})},G=async o=>{try{const e=await $.get(`/admin/search/${o}`);h.value=e.data,Array.isArray(h)?console.log("Products found:",h):console.log("Single product found:",h)}catch(e){e.response&&e.response.status===404?console.log(e.response.data.message):console.error("An error occurred:",e)}};X(()=>{const o=document.getElementById("dateInput"),e=new Date().toISOString().split("T")[0];o.value=e,Y(()=>{et("#perchesTable").DataTable({responsive:!0,scrollX:!0,scrollY:"300px",scrollCollapse:!0,paging:!0})})}),z(R,()=>{G(R.value)});const k=(o,e)=>{const s=y.value.find(a=>a.id===o);s&&(s.quantity=Math.max(0,s.quantity+e))},H=o=>{o.discount<0?o.discount=0:o.discount>100&&(o.discount=100)},_=o=>{const e=o.discount??0,s=o.cost*e/100;return o.cost-s},C=J(()=>y.value.reduce((o,e,s)=>{const a=_(e);return a*e.quantity-s.receives_total,o+a*e.quantity},0)),O=o=>(_(o)*o.quantity).toFixed(2);return(o,e)=>(d(),K(tt,null,{default:Z(()=>[t("div",st,[e[6]||(e[6]=t("div",{class:"col-sm-6"},[t("h4",{class:"mT-3"},"PURCHASE RETURN")],-1)),t("div",at,[t("ol",ot,[t("li",lt,[t("a",{href:o.route("admin.dashboard")},"HOME",8,nt)]),t("li",it,[t("a",{href:o.route("admin.perches")},"PURCHASE",8,dt)]),e[5]||(e[5]=t("li",{class:"breadcrumb-item active"},"RETURN PURCHASE",-1))])])]),t("div",rt,[t("div",ut,[t("div",ct,[e[11]||(e[11]=t("div",{class:"col-lg-3 col-12"},[t("div",{class:"input-group mb-3"},[t("span",{class:"input-group-text",id:"basic-addon1"},[t("img",{src:"/images/icon/calendar.png",alt:"",width:"20px"})]),t("input",{type:"date",class:"form-control",placeholder:"Username","aria-label":"Username","aria-describedby":"basic-addon1",id:"dateInput",required:""})])],-1)),t("div",mt,[t("div",pt,[e[8]||(e[8]=t("label",{class:"input-group-text",for:"inputGroupSelect01"},[t("img",{src:"/images/icon/user.png",alt:"",width:"20px"})],-1)),r(t("select",{class:"form-select",id:"inputGroupSelect01","onUpdate:modelValue":e[0]||(e[0]=s=>x.value=s)},[e[7]||(e[7]=t("option",{value:"",disabled:""},"Select Supplier",-1)),(d(!0),u(U,null,q(p.suppliers,s=>(d(),u("option",{key:s.id,value:s.id},[t("span",null,n(s.first_name)+" Â "+n(s.last_name),1)],8,vt))),128))],512),[[P,x.value]])])]),t("div",ht,[t("div",yt,[e[10]||(e[10]=t("label",{class:"input-group-text",for:"inputGroupSelect01"},[t("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),r(t("select",{class:"form-select",id:"inputGroupSelect01","onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s)},[e[9]||(e[9]=t("option",{value:"",disabled:""},"Select Warehouse",-1)),(d(!0),u(U,null,q(p.warehouses,s=>(d(),u("option",{key:s.id,value:s.id},n(s.name),9,_t))),128))],512),[[P,w.value]])])])])])]),t("div",bt,[t("div",ft,[t("div",gt,[e[13]||(e[13]=t("div",{class:"card-header card-header-background"},[t("h3",{class:"card-title"},"Purchase Details")],-1)),t("div",xt,[t("table",wt,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",{style:{width:"8%"}},"Product Code"),t("th",{style:{width:"8%"}},"Product name"),t("th",null,"Cost (Rs)"),t("th",null,"Discount (%)"),t("th",null,"Discount (Rs)"),t("th",{style:{width:"15%"}},"Quantity"),t("th",null,"Subtotal (Rs)")])],-1)),t("tbody",null,[(d(!0),u(U,null,q(y.value,s=>(d(),u("tr",{key:s.id},[t("td",null,n(s.code),1),t("td",null,n(s.name),1),t("td",null,n(s.cost),1),t("td",null,[r(t("input",{type:"number",class:"form-control","onUpdate:modelValue":a=>s.discount=a,min:"0",max:"100",onInput:a=>H(s),placeholder:"0"},null,40,St),[[b,s.discount]])]),t("td",null,n((s.discount/100*(s.quantity*s.cost)).toFixed(2)),1),t("td",null,[t("div",Pt,[t("div",qt,[t("button",{class:"btn btn-primary",type:"button",onClick:a=>k(s.id,-1)}," - ",8,Ut),r(t("input",{class:"form-control","aria-label":"Quantity input","onUpdate:modelValue":a=>s.quantity=a,min:"1"},null,8,Rt),[[b,s.quantity]]),t("button",{class:"btn btn-primary",type:"button",onClick:a=>k(s.id,1)}," + ",8,kt)])])]),t("td",null,n(O(s)),1)]))),128))])])])]),t("div",Ct,[e[14]||(e[14]=t("label",{for:"quantity"},"Response :",-1)),r(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=s=>g.value=s)},null,512),[[b,g.value]])])])]),t("div",Tt,[t("div",At,[t("div",Dt,[e[17]||(e[17]=t("div",{class:"card-header"},[t("h5",{class:"card-title fw-bold"},"Summery")],-1)),t("div",Vt,[t("div",Et,[t("div",It,[t("span",Mt,"Total: Rs "+n(C.value.toFixed(2)-p.purchase.receives_total),1),r(t("input",{type:"number",class:"form-control",placeholder:"0.00","aria-label":"Recipient's username","aria-describedby":"basic-addon2","onUpdate:modelValue":e[3]||(e[3]=s=>f.value=s)},null,512),[[b,f.value]])])]),t("div",Qt,[t("div",jt,[e[16]||(e[16]=t("label",{for:"name"},"Payment Type",-1)),r(t("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":e[4]||(e[4]=s=>S.value=s)},e[15]||(e[15]=[t("option",{value:"",disabled:""},"Select Payment Type",-1),t("option",{value:"1"},"Cash",-1),t("option",{value:"3"},"Credit",-1)]),512),[[P,S.value]])])]),t("div",{class:"col-12 text-end"},[t("button",{class:"btn btn-success",onClick:F},"Save Purchase")])])])])])]),_:1}))}};export{Yt as default};
