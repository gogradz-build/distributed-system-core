import{r as h,e as V,i as P,j,f as $,o as u,g as E,h as S,a as e,d as c,k as M,c as m,l as _,t as b,F as y,m as f,w as O,n as w}from"./app-mDYLW31A.js";import{_ as R}from"./AdminLayout-UUPC1Aa5.js";import"side-channel-list";import"side-channel-map";import"side-channel-weakmap";import"./AdminFooter-BVWJI1Iq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const B={class:"row"},D={class:"col-6"},F={class:"card card-success"},A={class:"card-body"},N={class:"form-group"},I=["value"],L={class:"row"},T={class:"col-12"},H={class:"card card-success"},q={class:"card-body"},z={class:"table table-borderless"},G={scope:"row"},J={scope:"row"},K=["onUpdate:modelValue","disabled","onChange"],Q=["onUpdate:modelValue","onChange"],W=["onUpdate:modelValue","disabled","onChange"],X=["onUpdate:modelValue","disabled","onChange"],Y=["onUpdate:modelValue","disabled","onChange"],Z={class:"row justify-content-end"},ee=["disabled"],ce={__name:"Permission",setup(se){const v=h([]),p=V(),d=h(""),a=h({student:{create:!1,view:!1,update:!1,delete:!1,all:!1},lecturer:{create:!1,view:!1,update:!1,delete:!1,all:!1},course:{create:!1,view:!1,update:!1,delete:!1,all:!1},module:{create:!1,view:!1,update:!1,delete:!1,all:!1},subject:{create:!1,view:!1,update:!1,delete:!1,all:!1},assignments:{create:!1,view:!1,update:!1,delete:!1,all:!1},assignments_marks:{create:!1,view:!1,update:!1,delete:!1,all:!1},exams:{create:!1,view:!1,update:!1,delete:!1,all:!1},payments:{create:!1,view:!1,update:!1,delete:!1,all:!1},events:{create:!1,view:!1,update:!1,delete:!1,all:!1},role:{create:!1,view:!1,delete:!1,all:!1},permission:{view:!1,update:!1}}),r=(o,t)=>{if(t==="all"){const n=a.value[o].all;Object.keys(a.value[o]).forEach(s=>{s!=="all"&&(a.value[o][s]=n)})}else a.value[o].all=Object.values(a.value[o]).slice(0,-1).every(Boolean)},g=async()=>{try{const o=await w.get("/roles");v.value=o.data}catch(o){console.error("Error fetching roles:",o)}},k=P(()=>{const o=v.value.find(t=>t.id===d.value);return(o==null?void 0:o.name.toLowerCase())==="super admin"});j(d,o=>{o&&C(o)});const C=async o=>{try{const n=(await w.get(`/roles/${o}/permissions`)).data;Object.keys(a.value).forEach(s=>{Object.keys(a.value[s]).forEach(i=>{a.value[s][i]=!1})}),n.forEach(s=>{const[i,l]=s.split(" ");a.value[i]&&a.value[i][l]!==void 0&&(a.value[i][l]=!0)})}catch(t){console.error("Error fetching role permissions:",t),p.error("Failed to fetch role permissions.")}},x=()=>{if(!d.value){p.error("No role selected.");return}const t={permissions:Object.entries(a.value).flatMap(([s,i])=>Object.entries(i).filter(([l,U])=>U&&l!=="all").map(([l])=>`${s} ${l}`))},n=d.value;w.put(`/roles/${n}/give-permission`,t).then(s=>{console.log("Permissions saved:",s),p.success("Permissions successfully assigned to the role!")}).catch(s=>{var i,l;console.error("Error saving permissions:",s),p.error(((l=(i=s.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to assign permissions.")})};return $(()=>{g()}),(o,t)=>(u(),E(R,null,{default:S(()=>[t[6]||(t[6]=e("div",{class:"row mb-2"},[e("div",{class:"col-sm-6 mt-2"},[e("h1",{class:"m-0"},"Role Permissions Management")]),e("div",{class:"col-sm-6 mt-2"},[e("ol",{class:"breadcrumb float-sm-right"},[e("li",{class:"breadcrumb-item"},[e("a",{href:"#"},"Home")]),e("li",{class:"breadcrumb-item active"},"Permissions Management")])])],-1)),e("div",B,[e("div",D,[e("div",F,[t[3]||(t[3]=e("div",{class:"card-header bg-secondary"},[e("h3",{class:"card-title"},"Select Role")],-1)),e("div",A,[e("form",null,[e("div",N,[t[2]||(t[2]=e("label",{for:""},"Role Name :",-1)),c(e("select",{class:"form-control","onUpdate:modelValue":t[0]||(t[0]=n=>d.value=n)},[t[1]||(t[1]=e("option",{value:"",disabled:"",selected:""},"Select Role",-1)),(u(!0),m(y,null,_(v.value,n=>(u(),m("option",{key:n.id,value:n.id},b(n.name),9,I))),128))],512),[[M,d.value]])])])])])])]),e("div",L,[e("div",T,[e("div",H,[t[5]||(t[5]=e("div",{class:"card-header bg-secondary"},[e("h3",{class:"card-title"},"Set Permissions")],-1)),e("div",q,[e("table",z,[t[4]||(t[4]=e("thead",null,[e("tr",null,[e("th",{class:"h5 fw-bold",scope:"col",style:{width:"15%"}},"ID"),e("th",{class:"h5 fw-bold",scope:"col",style:{width:"30%"}},"Task"),e("th",{class:"h5 fw-bold",scope:"col",style:{width:"12%"}},"Create"),e("th",{class:"h5 fw-bold",scope:"col",style:{width:"12%"}},"View"),e("th",{class:"h5 fw-bold",scope:"col",style:{width:"12%"}},"Update"),e("th",{class:"h5 fw-bold",scope:"col",style:{width:"12%"}},"Delete"),e("th",{class:"h5 fw-bold",scope:"col",style:{width:"12%"}},"All")])],-1)),e("tbody",null,[(u(!0),m(y,null,_(a.value,(n,s,i)=>(u(),m("tr",{key:s},[e("th",G,b(i+1),1),e("th",J,b(s.charAt(0).toUpperCase()+s.slice(1)),1),e("td",null,[c(e("input",{type:"checkbox","onUpdate:modelValue":l=>a.value[s].create=l,disabled:s==="permission",onChange:l=>r(s,"create")},null,40,K),[[f,a.value[s].create]])]),e("td",null,[c(e("input",{type:"checkbox","onUpdate:modelValue":l=>a.value[s].view=l,onChange:l=>r(s,"view")},null,40,Q),[[f,a.value[s].view]])]),e("td",null,[c(e("input",{type:"checkbox","onUpdate:modelValue":l=>a.value[s].update=l,disabled:s==="role",onChange:l=>r(s,"update")},null,40,W),[[f,a.value[s].update]])]),e("td",null,[c(e("input",{type:"checkbox","onUpdate:modelValue":l=>a.value[s].delete=l,disabled:s==="permission",onChange:l=>r(s,"delete")},null,40,X),[[f,a.value[s].delete]])]),e("td",null,[c(e("input",{type:"checkbox","onUpdate:modelValue":l=>a.value[s].all=l,disabled:s==="permission",onChange:l=>r(s,"all")},null,40,Y),[[f,a.value[s].all]])])]))),128))])]),e("div",Z,[e("button",{type:"submit",class:"btn btn-primary justify-content-end align-items-end",style:{width:"100px"},onClick:O(x,["prevent"]),disabled:k.value}," Save ",8,ee)])])])])])]),_:1}))}};export{ce as default};
