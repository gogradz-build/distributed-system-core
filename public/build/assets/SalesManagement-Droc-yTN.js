import{_ as Q}from"./AdminLayout-DxRoeMN4.js";import{D as $}from"./DeleteModel-C5VXcLeW.js";import{d as V,q as S,n as P,o as c,c as h,a as t,t as u,b as p,v as x,m as D,x as G,s as v,F as y,j as k,r as f,f as W,g as R,h as Y,i as H}from"./app-C2i026LC.js";import"./index-BKeKyArJ.js";import{$ as b}from"./dataTables.bootstrap4.min-73PbsmZ0.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AdminFooter-BK7-hYHZ.js";/* empty css                                                                    */const z={name:"AdminSalesStatus&ReturnUpdate",props:{sale_id:{type:Number,required:!0},fetchSales:{type:Function,required:!0},statusId:{type:Number,required:!0},close:{type:Boolean}},data(){return{sale:{},order_status:this.statusId,sale_return_show:!1,toast:V(),date_input:"",return_content:!1,formRef:null,search:"",todyDate:"",products:[],sub_total:0,warehouses:[],shops:[],refs:[],selectedProducts:[],reason:"",table:null}},computed:{shop(){var s;return((s=this.sale)==null?void 0:s.shop_id)||null},ref1(){var s;return((s=this.sale)==null?void 0:s.ref_id)||null},warehouse(){var s;return((s=this.sale)==null?void 0:s.warehouse_id)||null},payment_status(){var s;return((s=this.sale)==null?void 0:s.payment_status)||3},totalPrice(){return this.selectedProducts.reduce((s,e)=>{const a=this.calculateDiscountedPrice(e);return s+a*e.return_quantity},0)}},watch:{sale:{handler(s){var e;this.selectedProducts=((s==null?void 0:s.products)??[]).map(a=>({id:a.id,name:a.name,code:a.code,price:a.price,sellCount:a.sellCount,return_quantity:a.return_quantity,old_return_quantity:a.old_return_quantity,discount:a.discount,discounted_price:a.discounted_price||0,subtotal:a.subtotal,oldQuantity:a.oldQuantity})),this.reason=(e=this.sale)==null?void 0:e.reason},deep:!0},order_status(s,e){s==="4"?this.sale_return_show=!0:(this.sale_return_show=!1,this.return_content=!1)},close(s){s&&this.resetForm()},statusId(s){this.order_status=s}},methods:{async updateStatus(){try{if(this.order_status=="")document.getElementById("status").setAttribute("style","border-color: red !important;"),this.toast.error("Sale Status is Required");else{document.getElementById("status").setAttribute("style","border-color: green !important;"),document.getElementById("input-date").setAttribute("style","border-color: green !important;");const s=await S.post(`/admin/sales/${this.sale_id}`,{order_status:this.order_status,date_input:this.date_input});if(s.status===200){const e=s.data.message||"Order status updated successfully!";this.toast.success(e),this.fetchSales()}else alert("Error updating order status.")}}catch(s){console.error("Error updating status:",s),alert("Something went wrong!")}},async createReturn(){var e;this.getCreditLimit(this.shop),this.totalPrice-(((e=this.sale)==null?void 0:e.receives_amount)||0);const s={warehouse_id:warehouse.value,products:this.selectedProducts.map(a=>({product_id:a.id,price:a.price,return_quantity:a.return_quantity+a.old_return_quantity,discount:a.discount??0,subtotal:this.calculateDiscountedPrice(a)*a.quantity})),total_price:this.totalPrice,received_amount:this.sub_total,payment_status:+this.payment_status,shop_id:this.shop,receives_amount:this.sub_total,ref_id:this.ref1,reason:this.reason};S.put(`/saleReturns/${this.sale.id}`,s).then(a=>{var m,d;this.updateStatus(),(m=a==null?void 0:a.data)!=null&&m.message?this.toast.warning(a.data.message):(d=a==null?void 0:a.data)!=null&&d.error&&this.toast.error(a.data.error)}).catch(a=>{var m,d,r,o,_,w;(d=(m=a.response)==null?void 0:m.data)!=null&&d.errors?(console.log((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.errors),Object.values(a.response.data.errors||{}).flat().forEach(T=>{this.toast.error(T)})):(w=(_=a.response)==null?void 0:_.data)!=null&&w.message?this.toast.error(a.response.data.message):this.toast.error("An unexpected error occurred."),console.log(a)})},setTodayDate(){const s=new Date,e=5.5*60*60*1e3,a=new Date(s.getTime()+e).toISOString().slice(0,16);this.date_input=a},resetForm(){this.setTodayDate()},async showReturnContent(s){await Promise.all([this.fetchSale(),this.fetchWarehouse(),this.fetchShop(),this.fetchRfs()]),this.initDataTable(),this.return_content=s},async fetchWarehouse(){try{const s=await S.get("/warehouses");this.warehouses=s.data}catch(s){console.error("Error fetching courses:",s)}},async fetchShop(){try{const s=await S.get("/shops");this.shops=s.data}catch(s){console.error("Error fetching courses:",s)}},async fetchSale(){try{const s=await S.get(`/admin/sale/modal-return/${this.sale_id}`);this.sale=s.data.sale}catch(s){console.error("Error fetching sale:",s)}},getCreditLimit(s){console.log("credit limit"+s);const e=this.shops.find(a=>a.id===s);return e?e.credit_limit-e.credit:0},adjustQuantity(s,e){const a=this.selectedProducts.find(m=>m.id===s);a&&(a.return_quantity=Math.max(-a.old_return_quantity,a.return_quantity+e),a.return_quantity=Math.min(a.return_quantity,a.sellCount-a.old_return_quantity))},validateDiscount(s){s.discount<0?s.discount=0:s.discount>100&&(s.discount=100)},calculateDiscountedPrice(s){const e=s.discount??0,a=s.price*e/100;return s.price-a},async fetchRfs(){try{const s=await S.get("/refs");this.refs=s.data,console.log(s)}catch(s){console.error("Error fetching courses:",s)}},initDataTable(){b(document).ready(function(){let s=b("#modal-perches-table").DataTable();console.log("tabel "+s)}),P(()=>{b.fn.DataTable.isDataTable("#modal-perches-table")&&(console.log("if"),b("#modal-perches-table").DataTable().destroy()),b("#modal-perches-table").DataTable({responsive:!0,scrollX:!0,scrollY:"",scrollCollapse:!0,paging:!0})})}},mounted(){const s=new Date,e=5.5*60*60*1e3,a=new Date(s.getTime()+e).toISOString().slice(0,16);this.todyDate=this.date_input=a}},J={class:"row"},K={class:"col-lg-6"},Z={class:"col-lg-6"},tt={key:0,class:"salesReturn"},et={key:0,class:"text-danger mt-3"},st={key:1,class:"col-12 mt-4"},at={class:"row mb-4"},ot={class:"col-12"},lt={class:"row d-flex justify-content-start"},nt={class:"col-lg-3 col-12"},rt={class:"input-group mb-3"},it={class:"col-lg-3 col-12"},dt={class:"input-group mb-3"},ut=["value"],ct={class:"col-lg-3 col-12"},ht={class:"input-group mb-3"},mt=["value"],_t={class:"col-lg-3 col-12"},pt={class:"input-group mb-3"},gt=["value"],ft={class:"col-lg-3 col-12"},bt={class:"input-group mb-3"},yt=["value"],vt={class:"row mt-4"},wt={class:"col-12"},St={class:"card card-primary"},xt={class:"card-body"},Dt={class:"table-responsive"},kt={id:"modal-perches-table",class:"table table-hover"},Ct=["onUpdate:modelValue","onInput"],Tt={class:"row d-flex"},Rt={class:"input-group quantity-group"},Pt=["onClick"],qt=["onUpdate:modelValue"],It=["onClick"],Ut={class:"row d-flex"},Et={class:"col-lg-8"},Mt={class:"card card-success card-outline"},Vt={class:"card-body"},At={class:"col-lg-4"},Nt={class:"card card-success card-outline"},Ot={class:"card-body"},Bt={class:"col-12"},Lt={class:"input-group mb-3"},jt={class:"input-group-text",id:"basic-addon2"},Ft={class:"row mt-3"},Qt={class:"col-12 text-end"},$t={key:2,class:"col-12 d-flex justify-content-end"},Gt={key:1,class:"salesReturn"},Wt={class:"row mt-3"},Yt={class:"col-12 d-flex justify-content-end"};function Ht(s,e,a,m,d,r){return c(),h(y,null,[t("h6",null,"Sale id "+u(a.sale_id),1),e[27]||(e[27]=t("label",{for:"name"},"Order Status",-1)),t("div",J,[t("div",K,[p(t("input",{type:"datetime-local",class:"form-control",id:"input-date","onUpdate:modelValue":e[0]||(e[0]=o=>d.date_input=o)},null,512),[[x,d.date_input]])]),t("div",Z,[p(t("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":e[1]||(e[1]=o=>d.order_status=o),id:"status"},e[12]||(e[12]=[G('<option value="0" disabled>Select Order Status</option><option value="1">Start to Print</option><option value="2">Print</option><option value="3">Delivered</option><option value="4">Completed</option>',5)]),512),[[D,d.order_status]])])]),d.sale_return_show?(c(),h("div",tt,[d.return_content==!1?(c(),h("p",et,"Do you have any returns? then please click the yes button. If you do not have any changes please click the update button")):v("",!0),d.return_content?(c(),h("div",st,[t("div",at,[t("div",ot,[t("div",lt,[t("div",nt,[t("div",rt,[e[13]||(e[13]=t("span",{class:"input-group-text",id:"basic-addon1"},[t("img",{src:"/images/icon/calendar.png",alt:"",width:"20px"})],-1)),p(t("input",{type:"date",class:"form-control",placeholder:"Username","aria-label":"Username","onUpdate:modelValue":e[2]||(e[2]=o=>d.todyDate=o),"aria-describedby":"basic-addon1",id:"dateInput",required:""},null,512),[[x,d.todyDate]])])]),t("div",it,[t("div",dt,[e[15]||(e[15]=t("label",{class:"input-group-text",for:"inputGroupSelect01"},[t("img",{src:"/images/icon/sale create warehouse.svg",alt:"",width:"20px"})],-1)),p(t("select",{class:"form-select",id:"warehouse","onUpdate:modelValue":e[3]||(e[3]=o=>r.warehouse=o)},[e[14]||(e[14]=t("option",{selected:"",disabled:"",value:"0"},"Select WareHouse",-1)),(c(!0),h(y,null,k(d.warehouses,o=>(c(),h("option",{key:o.id,value:o.id},u(o.name),9,ut))),128))],512),[[D,r.warehouse]])])]),t("div",ct,[t("div",ht,[e[17]||(e[17]=t("label",{class:"input-group-text",for:"inputGroupSelect02"},[t("img",{src:"/images/icon/sale create store.svg",alt:"",width:"20px"})],-1)),p(t("select",{class:"form-select",id:"shop","onUpdate:modelValue":e[4]||(e[4]=o=>r.shop=o)},[e[16]||(e[16]=t("option",{selected:"",disabled:"",value:"0"},"Select shop",-1)),(c(!0),h(y,null,k(d.shops,o=>(c(),h("option",{key:o.id,value:o.id},u(o.name),9,mt))),128))],512),[[D,r.shop]])])]),t("div",_t,[t("div",pt,[e[19]||(e[19]=t("label",{class:"input-group-text",for:"inputGroupSelect02"},[t("img",{src:"/images/icon/sale create  ref.svg",alt:"",width:"20px"})],-1)),p(t("select",{class:"form-select",id:"ref","onUpdate:modelValue":e[5]||(e[5]=o=>r.ref1=o)},[e[18]||(e[18]=t("option",{selected:"",disabled:"",value:"0"},"Select Ref",-1)),(c(!0),h(y,null,k(d.refs,o=>(c(),h("option",{key:o.id,value:o.id},u(o.first_name),9,gt))),128))],512),[[D,r.ref1]])])]),t("div",ft,[t("div",bt,[e[20]||(e[20]=t("label",{class:"input-group-text",for:"inputGroupSelect02"},[t("img",{src:"/images/icon/sales_payments.svg",alt:"",width:"20px"})],-1)),t("input",{type:"number",class:"form-control",id:"credit_limit",value:r.getCreditLimit(r.shop),disabled:""},null,8,yt)])])])])]),t("div",vt,[t("div",wt,[t("div",St,[e[22]||(e[22]=t("div",{class:"card-header card-header-background"},[t("h3",{class:"card-title"},"Sales Items")],-1)),t("div",xt,[t("div",Dt,[t("table",kt,[e[21]||(e[21]=t("thead",null,[t("tr",null,[t("th",{style:{width:"8%"}},"Product Code"),t("th",{style:{width:"20%"}},"Product name"),t("th",null,"Price "),t("th",null,"Discount"),t("th",null,"Discount "),t("th",{style:{width:"15%"}},"Quantity"),t("th",{style:{width:"15%"}},"Returned"),t("th",{style:{width:"40%"}},"Return"),t("th",null,"Subtotal ")])],-1)),t("tbody",null,[(c(!0),h(y,null,k(d.selectedProducts,o=>(c(),h("tr",{key:o.id},[t("td",null,u(o.code),1),t("td",null,u(o.name),1),t("td",null,u(o.price),1),t("td",null,[p(t("input",{type:"number",class:"form-control","onUpdate:modelValue":_=>o.discount=_,min:"0",max:"100",onInput:_=>r.validateDiscount(o),placeholder:"0"},null,40,Ct),[[x,o.discount]])]),t("td",null,u((r.calculateDiscountedPrice(o)*o.return_quantity).toFixed(2)),1),t("td",null,u(o.sellCount),1),t("td",null,u(o.old_return_quantity),1),t("td",null,[t("div",Tt,[t("div",Rt,[t("button",{class:"btn btn-primary",type:"button",onClick:_=>r.adjustQuantity(o.id,-1)}," - ",8,Pt),p(t("input",{class:"form-control","aria-label":"Quantity input","onUpdate:modelValue":_=>o.return_quantity=_,disabled:""},null,8,qt),[[x,o.return_quantity]]),t("button",{class:"btn btn-primary",type:"button",onClick:_=>r.adjustQuantity(o.id,1)}," + ",8,It)])])]),t("td",null,u((o.price*o.return_quantity).toFixed(2)),1)]))),128))])])])])])])]),t("div",Ut,[t("div",Et,[t("div",Mt,[e[23]||(e[23]=t("div",{class:"card-header"},[t("h5",{class:"card-title fw-bold"},"Reason")],-1)),t("div",Vt,[p(t("textarea",{class:"form-control","onUpdate:modelValue":e[6]||(e[6]=o=>d.reason=o),rows:"3",placeholder:"Enter reason"},null,512),[[x,d.reason]])])])]),t("div",At,[t("div",Nt,[e[26]||(e[26]=t("div",{class:"card-header"},[t("h5",{class:"card-title fw-bold"},"Summary")],-1)),t("div",Ot,[t("div",Bt,[t("div",Lt,[t("span",jt,"Total: Rs "+u(r.totalPrice.toFixed(2)),1)]),e[25]||(e[25]=t("label",{for:"payment_status"},"Payment Type",-1)),p(t("select",{class:"form-select","onUpdate:modelValue":e[7]||(e[7]=o=>r.payment_status=o)},e[24]||(e[24]=[t("option",{value:"",disabled:""},"Select Payment Status",-1),t("option",{value:"1"},"Cash Returned",-1),t("option",{value:"3"},"By Credit",-1)]),512),[[D,r.payment_status]])]),t("div",Ft,[t("div",Qt,[t("button",{class:"btn btn-success",onClick:e[8]||(e[8]=(...o)=>r.createReturn&&r.createReturn(...o))},"Return Sale")])])])])])])])):v("",!0),d.return_content==!1?(c(),h("div",$t,[t("button",{class:"btn btn-primary mr-3",onClick:e[9]||(e[9]=o=>r.showReturnContent(!0))},"Yes"),t("button",{class:"btn btn-success",onClick:e[10]||(e[10]=(...o)=>r.updateStatus&&r.updateStatus(...o))},"Update")])):v("",!0)])):(c(),h("div",Gt,[t("div",Wt,[t("div",Yt,[t("button",{class:"btn btn-success",onClick:e[11]||(e[11]=(...o)=>r.updateStatus&&r.updateStatus(...o))},"Update")])])]))],64)}const Xt=X(z,[["render",Ht]]),zt={class:"row mb-2"},Jt={class:"col-sm-6"},Kt=["href"],Zt={class:"col-sm-6"},te={class:"breadcrumb float-sm-right mt-2"},ee={class:"breadcrumb-item"},se=["href"],ae={class:"row"},oe={class:"col-12"},le={class:"card card-secondary"},ne={class:"card-body"},re={id:"shopTable",class:"table table-hover"},ie={key:0,class:"badge badge-info"},de={key:1,class:"badge badge-warning"},ue={key:2,class:"badge badge-danger"},ce={key:3,class:"badge badge-success"},he=["href"],me={class:"d-flex"},_e=["onClick"],pe=["href"],ge=["href"],fe=["onClick"],be={class:"modal fade",id:"update-sales-and-sales-return","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},ye={class:"modal-dialog modal-xl"},ve={class:"modal-content"},we={class:"modal-body"},Ie={__name:"SalesManagement",props:{sale_updated_message:String},setup(s){const e=s,a=V();e.sale_update_message&&console.log(e.sale_updated_message);const m=f(!1),d=f(""),r=f(null),o=f(null),_=f(0),w=f(!1);function q(i,l){r.value=i,d.value=l,m.value=!0}function T(){r.value&&(A(r.value),m.value=!1)}const A=i=>{axios.delete(`/sales/${i}`).then(l=>{var n,g;(n=l==null?void 0:l.data)!=null&&n.message?(a.warning(l.data.message),I()):(g=l==null?void 0:l.data)!=null&&g.error&&a.error(l.data.error)}).catch(l=>{var n,g,C,M;(g=(n=l.response)==null?void 0:n.data)!=null&&g.errors?Object.values(l.response.data.errors||{}).flat().forEach(F=>{a.error(F)}):(M=(C=l.response)==null?void 0:C.data)!=null&&M.message?a.error(l.response.data.message):a.error("An unexpected error occurred."),console.error(l)})},N=()=>{};W(()=>{E().then(()=>{j()}),I(),P(()=>{const i=localStorage.getItem("successMessage");i&&(a.success(i),localStorage.removeItem("successMessage"))})});const O=f([]),I=async()=>{try{const i=await axios.get("/shops");O.value=i.data,console.log(i)}catch(i){console.error("Error fetching courses:",i)}},U=f([]),E=async()=>{try{const i=await axios.get("/sales");U.value=i.data}catch(i){console.error("Error fetching courses:",i)}},B=async(i,l)=>{w.value=!1,_.value=l,o.value=i;const n=document.getElementById("update-sales-and-sales-return");new bootstrap.Modal(n).show()},L=()=>{w.value=!0};function j(){P(()=>{b.fn.DataTable.isDataTable("#shopTable")&&b("#shopTable").DataTable().destroy(),b("#shopTable").DataTable({responsive:!0,scrollX:!0,scrollY:"",scrollCollapse:!0,paging:!0});const i=localStorage.getItem("successMessage");i&&(a.success(i),localStorage.removeItem("successMessage"))})}return(i,l)=>(c(),h(y,null,[R(Q,null,{default:Y(()=>[t("div",zt,[t("div",Jt,[l[2]||(l[2]=t("h4",{class:"mt-2"},"SALES",-1)),t("a",{href:i.route("admin.create.Sales")},l[1]||(l[1]=[t("button",{type:"button",class:"btn btn-primary mt-4 mb-4 mr-2"},[t("i",{class:"fas fa-solid fa-plus",style:{color:"#ffffff","margin-right":"5px"}}),H(" Create New Sales")],-1)]),8,Kt)]),t("div",Zt,[t("ol",te,[t("li",ee,[t("a",{href:i.route("admin.dashboard")},"Home",8,se)]),l[3]||(l[3]=t("li",{class:"breadcrumb-item active"},"Sales",-1))])])]),t("div",ae,[t("div",oe,[t("div",le,[l[8]||(l[8]=t("div",{class:"card-header card-header-background"},[t("h3",{class:"card-title"},"Sales Details")],-1)),t("div",ne,[t("table",re,[l[7]||(l[7]=t("thead",null,[t("tr",null,[t("th",{style:{width:"8%"}},"#"),t("th",{style:{width:"8%"}},"Sale ID"),t("th",{style:{width:"20%"}},"Shop Name"),t("th",{style:{width:"20%"}},"Ref Name"),t("th",{style:{width:"10%"}},"Oder Status"),t("th",{style:{width:"10%"}},"Sub Total (RS)"),t("th",{style:{width:"10%"}},"Payment (RS)"),t("th",{style:{width:"10%"}},"Created Date"),t("th",{style:{width:"20%"}},"Print"),t("th",{style:{width:"100%"}},"Action")])],-1)),t("tbody",null,[(c(!0),h(y,null,k(U.value,(n,g)=>(c(),h("tr",{key:n.sale_id},[t("td",null,u(1+g),1),t("td",null,u(n.sale_id),1),t("td",null,u(n.shop.name),1),t("td",null,u(n.ref_name),1),t("td",null,[+n.order_status==1?(c(),h("span",ie,"Start To Print "+u(n.status_update_at),1)):v("",!0),+n.order_status==2?(c(),h("span",de,"Print "+u(n.status_update_at),1)):v("",!0),+n.order_status==3?(c(),h("span",ue,"Delivered "+u(n.status_update_at),1)):v("",!0),+n.order_status==4?(c(),h("span",ce,"Completed "+u(n.status_update_at),1)):v("",!0)]),t("td",null,u(n.total_price),1),t("td",null,u(n.received_amount),1),t("td",null,u(n.created_at),1),t("td",null,[t("a",{href:i.route("sale.print",{sale:JSON.stringify(n)}),target:"_blank"},[t("img",{src:"/images/icon/print.png",width:"30px",height:"30px",alt:"",onClick:N,class:"print-icon"})],8,he)]),t("td",me,[t("img",{src:"/images/icon/repeat.png",width:"25px",height:"25px",style:{"margin-right":"10px"},alt:"",onClick:C=>B(n.sale_id,n.order_status),class:"salesStatusReturnUpdate"},null,8,_e),t("a",{href:i.route("admin.create.sales.return",n.sale_id)},l[4]||(l[4]=[t("img",{src:"/images/icon/return_icon.png",width:"25px",height:"25px",style:{"margin-right":"10px"},alt:"",class:"return-icon"},null,-1)]),8,pe),t("a",{href:i.route("sales.edit",n.sale_id)},l[5]||(l[5]=[t("img",{src:"/images/icon/edit.png",width:"30px",height:"30px",style:{"margin-right":"10px"},alt:"",class:"edit-icon"},null,-1)]),8,ge),t("a",{onClick:C=>q(n.sale_id,"Delete Sale"),style:{cursor:"pointer"}},l[6]||(l[6]=[t("img",{src:"/images/icon/trash-bin.png",alt:"",width:"25px",height:"25px",class:"table-action-icon"},null,-1)]),8,fe)])]))),128))])])])])])]),R($,{isModalOpen:m.value,modalTitle:d.value,onClose:l[0]||(l[0]=n=>m.value=!1),onConfirmDelete:T},null,8,["isModalOpen","modalTitle"])]),_:1}),t("div",be,[t("div",ye,[t("div",ve,[t("div",{class:"modal-header"},[l[9]||(l[9]=t("h5",{class:"modal-title",id:"staticBackdropLabel"},"UPDATE SALES STATUS & SALES RETURN",-1)),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:L})]),t("div",we,[R(Xt,{sale_id:o.value,fetchSales:E,statusId:_.value,close:w.value},null,8,["sale_id","statusId","close"])])])])])],64))}};export{Ie as default};
