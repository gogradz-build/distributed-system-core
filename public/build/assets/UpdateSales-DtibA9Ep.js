import{r as a,e as ae,f as ne,p as ie,j as de,n as _,i as re,o as n,g as ue,h as ce,a as e,d as i,v as m,k as w,c as d,l as x,t as r,F as S,s as me}from"./app-JnpFVuSp.js";import{_ as ve}from"./AdminLayout-CP0E-03s.js";import{$ as pe}from"./dataTables.bootstrap4.min-DdNG8ZfS.js";import"./AdminFooter-CrMPERQ2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const fe={class:"row mb-2"},be={class:"col-sm-6"},ge={class:"breadcrumb float-sm-right"},ye={class:"breadcrumb-item"},he=["href"],_e={class:"breadcrumb-item active"},we=["href"],xe={class:"row mb-4"},Se={class:"col-12"},Ce={class:"row d-flex justify-content-start"},Pe={class:"col-lg-3 col-12"},ke={class:"input-group mb-3"},Ee={class:"col-lg-3 col-12"},Ue={class:"input-group mb-3"},De=["value"],Ve={class:"col-lg-3 col-12"},Te={class:"input-group mb-3"},Ne=["value"],qe={class:"col-lg-3 col-12"},Ae={class:"input-group mb-3"},Ie=["value"],Be={class:"col-lg-3 col-12"},$e={class:"input-group mb-3"},Fe=["value"],Me={class:"row"},Re={class:"container result_container"},je={key:0,class:"search-result"},Le=["onClick"],Oe={key:1,class:"search-result"},Qe={class:"row",style:{"margin-top":"80px"}},Ge={class:"col-12"},We={class:"card card-primary"},He={class:"card-body"},Xe={id:"perchesTable",class:"table table-hover"},Ye=["onUpdate:modelValue","onInput"],ze={class:"row d-flex"},Je={class:"input-group quantity-group"},Ke=["onClick"],Ze=["onUpdate:modelValue"],et=["onClick"],tt={class:"d-flex justify-content-center align-items-center"},st=["onClick"],lt={class:"row d-flex justify-content-end"},ot={class:"col-lg-4",id:"cheque"},at={class:"card card-primary card-outline"},nt={class:"card-body"},it={class:"col-12"},dt={class:"form-group"},rt={class:"col-12"},ut={class:"form-group"},ct={class:"col-12"},mt={class:"form-group"},vt={class:"col-lg-4"},pt={class:"card card-danger card-outline"},ft={class:"card-body"},bt={class:"col-12"},gt={class:"input-group mb-3"},yt={class:"input-group-text",id:"basic-addon2"},Pt={__name:"UpdateSales",props:{sale:{type:Object,default:()=>({})}},setup(H){var B,$,F,M,R,j,L;a(null);const p=ae();a(0);const f=a(""),C=a("");a("");const v=a([]);a("");const X=a(0),u=H,c=a((((B=u.sale)==null?void 0:B.products)??[]).map(l=>({sale_item_id:l.sale_item_id,id:l.id,name:l.name,code:l.code,price:l.price,sellCount:l.sellCount,discount:l.discount,discounted_price:l.discounted_price||0,subtotal:l.subtotal,oldQuantity:l.oldQuantity}))),b=a((($=u.sale)==null?void 0:$.shop_id)||null),P=a(((F=u.sale)==null?void 0:F.received_amount)||null),k=a(((M=u.sale)==null?void 0:M.payment_type)||null),E=a(((R=u.sale)==null?void 0:R.ref_id)||null),g=a(((j=u.sale)==null?void 0:j.warehouse_id)||null),U=a(((L=u.sale)==null?void 0:L.order_status)||null);a(""),a({});const Y=async()=>{var s;const l=q(b.value);T.value-(((s=u.sale)==null?void 0:s.received_amount)||0);const t={warehouse_id:g.value,products:c.value.map(o=>({sale_item_id:o.sale_item_id,product_id:o.id,quantity:+o.sellCount,oldQuantity:+o.oldQuantity,price:o.price,discount:o.discount??0,subtotal:V(o)*o.quantity})),total_price:T.value,sub_total:X.value,payment_type:+k.value,todyDate:C.value,shop_id:b.value,received_amount:P.value,ref_id:E.value,credit:l,order_status:U.value};_.put(`/sales/${u.sale.id}`,t).then(o=>{var y,h;console.log(o),(y=o==null?void 0:o.data)!=null&&y.message?(localStorage.setItem("successMessage",o.data.message),window.location.href=route("admin.Sales")):(h=o==null?void 0:o.data)!=null&&h.error&&p.error(o.data.error)}).catch(o=>{var y,h,O,Q,G,W;(h=(y=o.response)==null?void 0:y.data)!=null&&h.errors?(console.log((Q=(O=o.response)==null?void 0:O.data)==null?void 0:Q.errors),Object.values(o.response.data.errors||{}).flat().forEach(oe=>{p.error(oe)})):(W=(G=o.response)==null?void 0:G.data)!=null&&W.message?p.error(o.response.data.message):p.error("An unexpected error occurred."),console.log(o)})},z=async(l,t)=>{if(t.value==0)p.warning("Please Select Warehouse"),document.getElementById("warehouse").style.border="1px solid red";else{document.getElementById("warehouse").style.border="1px solid black !important";try{const s=await _.get(`/admin/search/${l}/${t}`);v.value=s.data,Array.isArray(v)?console.log("Products found:",v):console.log("Single product found:",v)}catch(s){s.response&&s.response.status===404?console.log(s.response.data.message):console.error("An error occurred:",s)}}};function J(){if(g.value==0)p.warning("Please Select Warehouse"),document.getElementById("warehouse").style.border="1px solid red";else{document.getElementById("warehouse").style.border="1px solid red";const l=document.getElementById("offcanvasScrolling");new bootstrap.Offcanvas(l).show()}}ne(()=>{K(),Z(),le();const l=new Date().toISOString().split("T")[0];C.value=l,ie(()=>{pe("#perchesTable").DataTable({responsive:!0,scrollX:!0,scrollY:"300px",scrollCollapse:!0,paging:!0})})}),de(f,()=>{z(f.value,g.value)});const N=a([]),K=async()=>{try{const l=await _.get("/warehouses");N.value=l.data}catch(l){console.error("Error fetching courses:",l)}},D=a([]),Z=async()=>{try{const l=await _.get("/shops");D.value=l.data}catch(l){console.error("Error fetching courses:",l)}},q=l=>{const t=D.value.find(s=>s.id===l);return t?t.credit_limit-t.credit:0},ee=l=>{const t=c.value.find(s=>s.id===l.id);t?t.sellCount+=1:c.value.push({...l,sellCount:1})},te=l=>{c.value=c.value.filter(t=>t.id!==l)},A=(l,t)=>{const s=c.value.find(o=>o.id===l);s&&(s.sellCount=Math.max(1,s.sellCount+t))},se=l=>{l.discount<0?l.discount=0:l.discount>100&&(l.discount=100)},V=l=>{const t=l.discount??0,s=l.price*t/100;return l.price-s},T=re(()=>c.value.reduce((l,t)=>{const s=V(t);return l+s*t.sellCount},0)),I=a([]),le=async()=>{try{const l=await _.get("/refs");I.value=l.data,console.log(l)}catch(l){console.error("Error fetching courses:",l)}};return(l,t)=>(n(),ue(ve,null,{default:ce(()=>[e("div",fe,[t[12]||(t[12]=e("div",{class:"col-sm-6"},[e("h4",{class:"mt-3"},"UPDATE SALES")],-1)),e("div",be,[e("ol",ge,[e("li",ye,[e("a",{href:l.route("admin.dashboard")},"HOME",8,he)]),e("li",_e,[e("a",{href:l.route("admin.Sales")},"SALES",8,we)]),t[11]||(t[11]=e("li",{class:"breadcrumb-item active"},"UPDATE SALES",-1))])])]),e("div",xe,[e("div",Se,[e("div",Ce,[e("div",Pe,[e("div",ke,[t[13]||(t[13]=e("span",{class:"input-group-text",id:"basic-addon1"},[e("img",{src:"/images/icon/calendar.png",alt:"",width:"20px"})],-1)),i(e("input",{type:"date",class:"form-control",placeholder:"Username","aria-label":"Username","onUpdate:modelValue":t[0]||(t[0]=s=>C.value=s),"aria-describedby":"basic-addon1",id:"dateInput",required:""},null,512),[[m,C.value]])])]),e("div",Ee,[e("div",Ue,[t[15]||(t[15]=e("label",{class:"input-group-text",for:"inputGroupSelect01"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),i(e("select",{class:"form-select",id:"warehouse","onUpdate:modelValue":t[1]||(t[1]=s=>g.value=s)},[t[14]||(t[14]=e("option",{selected:"",disabled:"",value:"0"},"Select WareHouse",-1)),(n(!0),d(S,null,x(N.value,s=>(n(),d("option",{key:s.id,value:s.id},r(s.name),9,De))),128))],512),[[w,g.value]])])]),e("div",Ve,[e("div",Te,[t[17]||(t[17]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),i(e("select",{class:"form-select",id:"shop","onUpdate:modelValue":t[2]||(t[2]=s=>b.value=s)},[t[16]||(t[16]=e("option",{selected:"",disabled:"",value:"0"},"Select shop",-1)),(n(!0),d(S,null,x(D.value,s=>(n(),d("option",{key:s.id,value:s.id},r(s.name),9,Ne))),128))],512),[[w,b.value]])])]),e("div",qe,[e("div",Ae,[t[19]||(t[19]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),i(e("select",{class:"form-select",id:"ref","onUpdate:modelValue":t[3]||(t[3]=s=>E.value=s)},[t[18]||(t[18]=e("option",{selected:"",disabled:"",value:"0"},"Select Ref",-1)),(n(!0),d(S,null,x(I.value,s=>(n(),d("option",{key:s.id,value:s.id},r(s.first_name),9,Ie))),128))],512),[[w,E.value]])])]),e("div",Be,[e("div",$e,[t[20]||(t[20]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),e("input",{type:"number",class:"form-control",id:"credit_limit",value:q(b.value),disabled:""},null,8,Fe)])])])])]),e("div",Me,[e("div",Re,[i(e("input",{class:"form-control",type:"text",placeholder:"Search Products...","aria-label":"default input example","onUpdate:modelValue":t[4]||(t[4]=s=>f.value=s)},null,512),[[m,f.value]]),f.value&&v.value.length>0?(n(),d("div",je,[e("ul",null,[(n(!0),d(S,null,x(v.value,s=>(n(),d("li",{key:s.id,onClick:o=>ee(s),class:"product-item",style:{cursor:"pointer"}},r(s.name)+" ("+r(s.code)+") - Rs "+r(s.price),9,Le))),128))])])):f.value&&v.value.length===0?(n(),d("div",Oe,t[21]||(t[21]=[e("p",null,"No products found...",-1)]))):me("",!0)])]),e("div",{class:"row"},[e("div",{class:"col-12 mt-4"},[e("button",{type:"button",class:"btn btn-outline-danger m-2","aria-controls":"offcanvasScrolling",onClick:J}," Category1 ")])]),e("div",Qe,[e("div",Ge,[e("div",We,[t[24]||(t[24]=e("div",{class:"card-header card-header-background"},[e("h3",{class:"card-title"},"Sales Items")],-1)),e("div",He,[e("table",Xe,[t[23]||(t[23]=e("thead",null,[e("tr",null,[e("th",{style:{width:"8%"}},"Product Code"),e("th",{style:{width:"8%"}},"Product name"),e("th",null,"Price (Rs)"),e("th",null,"Discount (%)"),e("th",null,"Discount (Rs)"),e("th",{style:{width:"15%"}},"Quantity"),e("th",null,"Subtotal (Rs)"),e("th",{style:{"text-align":"center",width:"8%"}},"Action")])],-1)),e("tbody",null,[(n(!0),d(S,null,x(c.value,s=>(n(),d("tr",{key:s.id},[e("td",null,r(s.code),1),e("td",null,r(s.name),1),e("td",null,r(s.price),1),e("td",null,[i(e("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>s.discount=o,min:"0",max:"100",onInput:o=>se(s),placeholder:"0"},null,40,Ye),[[m,s.discount]])]),e("td",null,r((V(s)*s.sellCount).toFixed(2)),1),e("td",null,[e("div",ze,[e("div",Je,[e("button",{class:"btn btn-primary",type:"button",onClick:o=>A(s.id,-1)}," - ",8,Ke),i(e("input",{class:"form-control","aria-label":"Quantity input","onUpdate:modelValue":o=>s.sellCount=o,min:"1"},null,8,Ze),[[m,s.sellCount]]),e("button",{class:"btn btn-primary",type:"button",onClick:o=>A(s.id,1)}," + ",8,et)])])]),e("td",null,r((s.price*s.sellCount).toFixed(2)),1),e("td",tt,[e("a",{onClick:o=>te(s.id),style:{cursor:"pointer"}},t[22]||(t[22]=[e("i",{class:"fas fa-solid fa-trash mr-4",style:{color:"#FF0000"}},null,-1)]),8,st)])]))),128))])])])])])]),e("div",lt,[e("div",ot,[e("div",at,[t[31]||(t[31]=e("div",{class:"card-header"},[e("h5",{class:"card-title fw-bold"},"Cheque Details")],-1)),e("div",nt,[e("div",it,[e("div",dt,[t[25]||(t[25]=e("label",{for:"name"},"Bank Name :",-1)),i(e("input",{type:"text",class:"form-control",id:"bank_name",placeholder:"Enter Product Name","onUpdate:modelValue":t[5]||(t[5]=s=>l.bank_name=s)},null,512),[[m,l.bank_name]]),t[26]||(t[26]=e("div",{class:"invalid-feedback"}," Please Provide Enter Product Name ",-1))])]),e("div",rt,[e("div",ut,[t[27]||(t[27]=e("label",{for:"name"},"Cheque Number :",-1)),i(e("input",{type:"text",class:"form-control",id:"cheque_number",placeholder:"Enter Product Name","onUpdate:modelValue":t[6]||(t[6]=s=>l.cheque_number=s)},null,512),[[m,l.cheque_number]]),t[28]||(t[28]=e("div",{class:"invalid-feedback"}," Please Provide Enter Product Name ",-1))])]),e("div",ct,[e("div",mt,[t[29]||(t[29]=e("label",{for:"name"},"Expire Date :",-1)),i(e("input",{type:"date",class:"form-control",id:"expire_date",placeholder:"Enter Product Name","onUpdate:modelValue":t[7]||(t[7]=s=>l.expire_date=s)},null,512),[[m,l.expire_date]]),t[30]||(t[30]=e("div",{class:"invalid-feedback"}," Please Provide Enter Product Name ",-1))])])])])]),e("div",vt,[e("div",pt,[t[36]||(t[36]=e("div",{class:"card-header"},[e("h5",{class:"card-title fw-bold"},"Summary")],-1)),e("div",ft,[e("div",bt,[e("div",gt,[e("span",yt,"Total: Rs "+r(T.value.toFixed(2)),1),i(e("input",{type:"number",class:"form-control",placeholder:"0.00","aria-label":"Recipient's username","aria-describedby":"basic-addon2","onUpdate:modelValue":t[8]||(t[8]=s=>P.value=s)},null,512),[[m,P.value]])]),t[34]||(t[34]=e("label",{for:"name"},"Payment Type",-1)),i(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":t[9]||(t[9]=s=>k.value=s)},t[32]||(t[32]=[e("option",{value:"",disabled:""},"Select Payment Type",-1),e("option",{value:"1"},"Cash",-1),e("option",{value:"2"},"Cheque",-1),e("option",{value:"3"},"Credit",-1)]),512),[[w,k.value]]),t[35]||(t[35]=e("label",{for:"name"},"Order Status",-1)),i(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":t[10]||(t[10]=s=>U.value=s)},t[33]||(t[33]=[e("option",{value:"",disabled:""},"Select Order Status",-1),e("option",{value:"1"},"Start to Print",-1),e("option",{value:"2"},"Print",-1),e("option",{value:"3"},"Delivered",-1)]),512),[[w,U.value]])]),e("div",{class:"row"},[e("div",{class:"col-12 text-end"},[e("button",{class:"btn btn-success",onClick:Y},"Update Sale")])])])])])]),t[37]||(t[37]=e("div",{class:"offcanvas offcanvas-end","data-bs-scroll":"true","data-bs-backdrop":"false",tabindex:"-1",id:"offcanvasScrolling","aria-labelledby":"offcanvasScrollingLabel"},[e("div",{class:"offcanvas-header"},[e("h5",{class:"offcanvas-title",id:"offcanvasScrollingLabel"},"Category Name"),e("button",{type:"button",class:"btn-close text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"})]),e("div",{class:"offcanvas-body"},[e("div",{class:"row"},[e("div",{class:"container result_container"},[e("input",{class:"form-control",type:"text",placeholder:"Search Products...","aria-label":"default input example"}),e("div",{class:"search-result"},[e("p",null,"456 product")])])]),e("div",{class:"row mt-4"},[e("div",{class:"col-12"}," Product Name (Code) ")])])],-1))]),_:1}))}};export{Pt as default};
