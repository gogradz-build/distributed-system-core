import{Q as O,e as Q,r as l,f as N,p as H,j as W,n as f,i as L,o as i,g as X,h as Y,a as e,d,k as y,c as r,l as _,t as n,F as b,v as p,s as z}from"./app-JnpFVuSp.js";import{_ as J}from"./AdminLayout-CP0E-03s.js";import{$ as K}from"./dataTables.bootstrap4.min-DdNG8ZfS.js";import"./vue-quill.snow-Bk9IZUCL.js";import"./AdminFooter-CrMPERQ2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"row mb-2"},ee={class:"col-sm-6"},te={class:"breadcrumb float-sm-right"},se={class:"breadcrumb-item"},oe=["href"],ae={class:"breadcrumb-item active"},le=["href"],ne={class:"row mb-4"},ie={class:"col-12"},re={class:"row d-flex justify-content-center"},de={class:"col-lg-3 col-12"},ce={class:"input-group mb-3"},ue=["value"],me={class:"col-lg-3 col-12"},pe={class:"input-group mb-3"},ve=["value"],he={class:"row"},fe={class:"container result_container"},ye={key:0,class:"search-result"},_e=["onClick"],be={key:1,class:"search-result"},ge={class:"row mt-4"},we={class:"col-12"},xe={class:"card card-primary"},Pe={class:"card-body"},Se={id:"perchesTable",class:"table table-hover"},ke=["onUpdate:modelValue","onInput"],Ce={class:"row d-flex"},qe={class:"input-group quantity-group"},Te=["onClick"],Ue=["onUpdate:modelValue"],De=["onClick"],Ve={class:"d-flex justify-content-center align-items-center"},Ee=["onClick"],Ae={class:"row d-flex justify-content-end"},Fe={class:"col-lg-4"},Ie={class:"card card-info card-outline"},Re={class:"card-body"},$e={class:"col-lg-12"},Me={class:"form-group"},je={class:"col-12"},Be={class:"input-group mb-3"},Ge={class:"input-group-text",id:"basic-addon2"},Oe={class:"col-12"},Qe={class:"form-group"},Ne={class:"col-12"},He={class:"form-group"},et={__name:"CreatePerches",setup(We){O();const v=Q();l(null),l(0);const g=l(0),m=l(""),w=l(""),x=l(""),P=l(""),k=l(""),S=l(""),u=l(""),c=l([]);l({code:"",name:"",cost:"",image:"",description:"",variation_id:"",category_id:""});const F=async()=>{const o={supplier_id:w.value,warehouse_id:x.value,products:c.value.map(t=>({product_id:t.id,quantity:+t.quantity,cost:t.cost,discount:t.discount??0,discounted_price:h(t),paid_amount:h(t)*t.quantity})),total_price:U.value,received_amount:g.value,payment_status:+P.value,purchase_code:S.value,order_status:0};f.post("/purchases",o).then(t=>{var s,a;console.log(t),(s=t==null?void 0:t.data)!=null&&s.message?(localStorage.setItem("successMessage",t.data.message),window.location.href=route("admin.perches")):(a=t==null?void 0:t.data)!=null&&a.error&&v.error(t.data.error)}).catch(t=>{var s,a,D,V,E,A;(a=(s=t.response)==null?void 0:s.data)!=null&&a.errors?(console.log((V=(D=t.response)==null?void 0:D.data)==null?void 0:V.errors),Object.values(t.response.data.errors||{}).flat().forEach(G=>{v.error(G)})):(A=(E=t.response)==null?void 0:E.data)!=null&&A.message?v.error(t.response.data.message):v.error("An unexpected error occurred."),console.log(t)})},I=async o=>{try{const t=await f.get(`/admin/search/${o}`);u.value=t.data,Array.isArray(u)?console.log("Products found:",u):console.log("Single product found:",u)}catch(t){t.response&&t.response.status===404?console.log(t.response.data.message):console.error("An error occurred:",t)}};N(()=>{$(),R();const o=document.getElementById("dateInput"),t=new Date().toISOString().split("T")[0];o.value=t,H(()=>{K("#perchesTable").DataTable({responsive:!0,scrollX:!0,scrollY:"300px",scrollCollapse:!0,paging:!0})})}),W(m,()=>{I(m.value)});const C=l([]),R=async()=>{try{const o=await f.get("/suppliers");C.value=o.data,console.log(o)}catch(o){console.error("Error fetching courses:",o)}},q=l([]),$=async()=>{try{const o=await f.get("/warehouses");q.value=o.data}catch(o){console.error("Error fetching courses:",o)}},M=o=>{const t=c.value.find(s=>s.id===o.id);t?t.quantity+=1:c.value.push({...o,quantity:1})},j=o=>{c.value=c.value.filter(t=>t.id!==o)},T=(o,t)=>{const s=c.value.find(a=>a.id===o);s&&(s.quantity=Math.max(1,s.quantity+t))},B=o=>{o.discount<0?o.discount=0:o.discount>100&&(o.discount=100)},h=o=>{const t=o.discount??0,s=o.cost*t/100;return o.cost-s},U=L(()=>c.value.reduce((o,t)=>{const s=h(t);return o+s*t.quantity},0));return(o,t)=>(i(),X(J,null,{default:Y(()=>[e("div",Z,[t[8]||(t[8]=e("div",{class:"col-sm-6"},[e("h4",{class:"mT-3"},"CREATE PURCHASE")],-1)),e("div",ee,[e("ol",te,[e("li",se,[e("a",{href:o.route("admin.dashboard")},"Home",8,oe)]),e("li",ae,[e("a",{href:o.route("admin.perches")},"Purchase",8,le)]),t[7]||(t[7]=e("li",{class:"breadcrumb-item active"},"Create Purchase",-1))])])]),e("div",ne,[e("div",ie,[e("div",re,[t[13]||(t[13]=e("div",{class:"col-lg-3 col-12"},[e("div",{class:"input-group mb-3"},[e("span",{class:"input-group-text",id:"basic-addon1"},[e("img",{src:"/images/icon/calendar.png",alt:"",width:"20px"})]),e("input",{type:"date",class:"form-control",placeholder:"Username","aria-label":"Username","aria-describedby":"basic-addon1",id:"dateInput",required:""})])],-1)),e("div",de,[e("div",ce,[t[10]||(t[10]=e("label",{class:"input-group-text",for:"inputGroupSelect01"},[e("img",{src:"/images/icon/user.png",alt:"",width:"20px"})],-1)),d(e("select",{class:"form-select",id:"inputGroupSelect01","onUpdate:modelValue":t[0]||(t[0]=s=>w.value=s)},[t[9]||(t[9]=e("option",{value:"",disabled:""},"Select Supplier",-1)),(i(!0),r(b,null,_(C.value,s=>(i(),r("option",{key:s.id,value:s.id},[e("span",null,n(s.first_name)+" Â "+n(s.last_name),1)],8,ue))),128))],512),[[y,w.value]])])]),e("div",me,[e("div",pe,[t[12]||(t[12]=e("label",{class:"input-group-text",for:"inputGroupSelect01"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),d(e("select",{class:"form-select",id:"inputGroupSelect01","onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s)},[t[11]||(t[11]=e("option",{value:"",disabled:""},"Select Warehouse",-1)),(i(!0),r(b,null,_(q.value,s=>(i(),r("option",{key:s.id,value:s.id},n(s.name),9,ve))),128))],512),[[y,x.value]])])])])])]),e("div",he,[e("div",fe,[d(e("input",{class:"form-control",type:"text",placeholder:"Search Products...","aria-label":"default input example","onUpdate:modelValue":t[2]||(t[2]=s=>m.value=s)},null,512),[[p,m.value]]),m.value&&u.value.length>0?(i(),r("div",ye,[e("ul",null,[(i(!0),r(b,null,_(u.value,s=>(i(),r("li",{key:s.id,onClick:a=>M(s),class:"product-item",style:{cursor:"pointer"}},n(s.name)+" ("+n(s.code)+") - Rs "+n(s.cost),9,_e))),128))])])):m.value&&u.value.length===0?(i(),r("div",be,t[14]||(t[14]=[e("p",null,"No products found...",-1)]))):z("",!0)])]),e("div",ge,[e("div",we,[e("div",xe,[t[17]||(t[17]=e("div",{class:"card-header card-header-background"},[e("h3",{class:"card-title"},"Purchase Details")],-1)),e("div",Pe,[e("table",Se,[t[16]||(t[16]=e("thead",null,[e("tr",null,[e("th",{style:{width:"8%"}},"Product Code"),e("th",{style:{width:"10%"}},"Product name"),e("th",{style:{width:"10%"}},"Price (Rs)"),e("th",{style:{width:"10%"}},"Discount (%)"),e("th",{style:{width:"10%"}},"Discount (Rs)"),e("th",{style:{width:"10%"}},"Quantity"),e("th",{style:{width:"10%"}},"Subtotal (Rs)"),e("th",{style:{"text-align":"center",width:"8%"}},"Action")])],-1)),e("tbody",null,[(i(!0),r(b,null,_(c.value,s=>(i(),r("tr",{key:s.id},[e("td",null,n(s.code),1),e("td",null,n(s.name),1),e("td",null,n(s.cost),1),e("td",null,[d(e("input",{type:"number",class:"form-control","onUpdate:modelValue":a=>s.discount=a,min:"0",max:"100",onInput:a=>B(s),placeholder:"0"},null,40,ke),[[p,s.discount]])]),e("td",null,n((s.discount/100*(s.quantity*s.cost)).toFixed(2)),1),e("td",null,[e("div",Ce,[e("div",qe,[e("button",{class:"btn btn-primary",type:"button",onClick:a=>T(s.id,-1)}," - ",8,Te),d(e("input",{class:"form-control","aria-label":"Quantity input","onUpdate:modelValue":a=>s.quantity=a,min:"1"},null,8,Ue),[[p,s.quantity]]),e("button",{class:"btn btn-primary",type:"button",onClick:a=>T(s.id,1)}," + ",8,De)])])]),e("td",null,n((h(s)*s.quantity).toFixed(2)),1),e("td",Ve,[e("a",{onClick:a=>j(s.id),style:{cursor:"pointer"}},t[15]||(t[15]=[e("i",{class:"fas fa-solid fa-trash mr-4",style:{color:"#FF0000"}},null,-1)]),8,Ee)])]))),128))])])])])])]),e("div",Ae,[e("div",Fe,[e("div",Ie,[t[25]||(t[25]=e("div",{class:"card-header"},[e("h5",{class:"card-title fw-bold"},"Summery")],-1)),e("div",Re,[e("div",$e,[e("div",Me,[t[18]||(t[18]=e("label",{for:"quantity"},"Purchase Code :",-1)),d(e("input",{type:"text",class:"form-control",id:"purchase_code",placeholder:"Enter Product purchase code","onUpdate:modelValue":t[3]||(t[3]=s=>S.value=s)},null,512),[[p,S.value]]),t[19]||(t[19]=e("div",{class:"invalid-feedback"}," Please Provide Enter purchase code ",-1))])]),e("div",je,[t[20]||(t[20]=e("label",{for:"quantity"},"Balance :",-1)),e("div",Be,[e("span",Ge,"Total: Rs "+n(U.value.toFixed(2)),1),d(e("input",{type:"number",class:"form-control",placeholder:"0.00","aria-label":"Recipient's username","aria-describedby":"basic-addon2","onUpdate:modelValue":t[4]||(t[4]=s=>g.value=s)},null,512),[[p,g.value]])])]),e("div",Oe,[e("div",Qe,[t[22]||(t[22]=e("label",{for:"name"},"Payment Type",-1)),d(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":t[5]||(t[5]=s=>P.value=s)},t[21]||(t[21]=[e("option",{value:"",disabled:""},"Select Payment Type",-1),e("option",{value:"1"},"Cash",-1),e("option",{value:"3"},"Credit",-1)]),512),[[y,P.value]])])]),e("div",Ne,[e("div",He,[t[24]||(t[24]=e("label",{for:"name"},"Order Status",-1)),d(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":t[6]||(t[6]=s=>k.value=s)},t[23]||(t[23]=[e("option",{value:"",disabled:""},"Select Order Status",-1),e("option",{value:"1"},"Pending",-1),e("option",{value:"2"},"Confirmed",-1),e("option",{value:"3"},"Delivered",-1)]),512),[[y,k.value]])])]),e("div",{class:"col-12 text-end"},[e("button",{class:"btn btn-success",onClick:F},"Save Purchase")])])])])])]),_:1}))}};export{et as default};
