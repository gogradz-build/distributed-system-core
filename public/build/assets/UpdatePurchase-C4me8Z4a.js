import{Q as N,d as W,r as l,f as X,n as Y,k as z,e as J,o as d,l as K,h as Z,a as t,b as r,m as x,c as u,j as P,t as i,F as S,v as h,q as B}from"./app-DuMmWb0e.js";import{_ as tt}from"./AdminLayout-CuGKItQZ.js";import{$ as et}from"./dataTables.bootstrap4.min-Db9EHKM2.js";import"./Delta-BMm4mRWE.js";/* empty css                       */import"./AdminFooter-i6V7ulTS.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const st={class:"row mb-2"},at={class:"col-sm-6"},ot={class:"breadcrumb float-sm-right mt-2"},lt={class:"breadcrumb-item"},it=["href"],nt={class:"breadcrumb-item active"},dt=["href"],rt={class:"row mb-4"},ct={class:"col-12"},ut={class:"row d-flex justify-content-center"},mt={class:"col-lg-3 col-12"},pt={class:"input-group mb-3"},vt=["value"],ht={class:"col-lg-3 col-12"},_t={class:"input-group mb-3"},yt=["value"],bt={class:"row mt-4"},ft={class:"col-12"},gt={class:"card card-primary"},wt={class:"card-body"},xt={id:"perchesTable",class:"table table-hover"},Pt=["onUpdate:modelValue","onInput"],St={class:"row d-flex"},kt={class:"input-group quantity-group"},qt=["onClick"],Ct=["onUpdate:modelValue"],Ut=["onClick"],Dt={class:"justify-content-center align-items-center"},Tt=["onClick"],At={class:"row d-flex justify-content-end"},Vt={class:"col-lg-4"},It={class:"card card-success card-outline"},jt={class:"card-body"},Et={class:"col-lg-12"},Mt={class:"form-group"},Rt={class:"col-12"},$t={class:"input-group mb-3"},Bt={class:"input-group-text",id:"basic-addon2"},Ft={class:"col-12"},Qt={class:"form-group"},zt={__name:"UpdatePurchase",props:{purchase:{type:Object,default:()=>({})},suppliers:{type:Array,default:()=>[]},warehouses:{type:Array,default:()=>[]},products:{type:Array,default:()=>[]}},setup(_){var U,D,T,A,V,I,j;N();const m=W();l(null),l(0);const k=l(""),p=l("");l({code:"",name:"",cost:"",price:"",image:"",description:"",variation_id:"",category_id:""});const n=_,c=l((((U=n.purchase)==null?void 0:U.products)??[]).map(a=>({purchase_item_id:a.id,id:a.product_id,name:a.name,code:a.code,cost:a.cost,quantity:a.quantity,discount:a.discount,discounted_price:a.discounted_price||0,subtotal:a.subtotal,oldQuantity:a.oldQuantity}))),y=l(((D=n.purchase)==null?void 0:D.supplier_id)||null),b=l(((T=n.purchase)==null?void 0:T.warehouse_id)||null),f=l(((A=n.purchase)==null?void 0:A.payment_status)||null),F=l(((V=n.purchase)==null?void 0:V.order_status)||null),g=l(((I=n.purchase)==null?void 0:I.received_amount)||null),w=l(((j=n.purchase)==null?void 0:j.purchase_code)||null),Q=async()=>{const a={supplier_id:y.value,warehouse_id:b.value,products:c.value.map(e=>({purchase_item_id:e.purchase_item_id,product_id:e.id,quantity:+e.quantity,cost:e.cost,discount:e.discount??0,discounted_price:v(e),paid_amount:v(e)*e.quantity})),total_price:C.value,received_amount:g.value,purchase_code:w.value,payment_status:+f.value,order_status:F.value};B.put(route("purchases.update",n.purchase.id),a).then(e=>{var s,o;console.log(e),(s=e==null?void 0:e.data)!=null&&s.message?(localStorage.setItem("successMessage",e.data.message),window.location.href=route("admin.perches")):(o=e==null?void 0:e.data)!=null&&o.error&&m.error(e.data.error)}).catch(e=>{var s,o,E,M,R,$;(o=(s=e.response)==null?void 0:s.data)!=null&&o.errors?(console.log((M=(E=e.response)==null?void 0:E.data)==null?void 0:M.errors),Object.values(e.response.data.errors||{}).flat().forEach(L=>{m.error(L)})):($=(R=e.response)==null?void 0:R.data)!=null&&$.message?m.error(e.response.data.message):m.error("An unexpected error occurred."),console.log(e)})},G=async a=>{try{const e=await B.get(`/admin/search/${a}`);p.value=e.data,Array.isArray(p)?console.log("Products found:",p):console.log("Single product found:",p)}catch(e){e.response&&e.response.status===404?console.log(e.response.data.message):console.error("An error occurred:",e)}};X(()=>{const a=document.getElementById("dateInput"),e=new Date().toISOString().split("T")[0];a.value=e,Y(()=>{et("#perchesTable").DataTable({responsive:!0,scrollX:!0,scrollY:"",scrollCollapse:!0,paging:!0})})}),z(k,()=>{G(k.value)});const O=a=>{c.value=c.value.filter(e=>e.id!==a)},q=(a,e)=>{const s=c.value.find(o=>o.id===a);s&&(s.quantity=Math.max(0,s.quantity+e))},H=a=>{a.discount<0?a.discount=0:a.discount>100&&(a.discount=100)},v=a=>{const e=a.discount??0,s=a.cost*e/100;return a.cost-s},C=J(()=>c.value.reduce((a,e)=>{const s=v(e);return a+s*e.quantity},0));return(a,e)=>(d(),K(tt,null,{default:Z(()=>[t("div",st,[e[6]||(e[6]=t("div",{class:"col-sm-6"},[t("h4",{class:"mt-2"},"UPDATE PURCHASE")],-1)),t("div",at,[t("ol",ot,[t("li",lt,[t("a",{href:a.route("admin.dashboard")},"Home",8,it)]),t("li",nt,[t("a",{href:a.route("admin.perches")},"Purchase",8,dt)]),e[5]||(e[5]=t("li",{class:"breadcrumb-item active"},"Update Purchase",-1))])])]),t("div",rt,[t("div",ct,[t("div",ut,[e[11]||(e[11]=t("div",{class:"col-lg-3 col-12"},[t("div",{class:"input-group mb-3"},[t("span",{class:"input-group-text",id:"basic-addon1"},[t("img",{src:"/images/icon/calendar.svg",alt:"",width:"20px"})]),t("input",{type:"date",class:"form-control",placeholder:"Username","aria-label":"Username","aria-describedby":"basic-addon1",id:"dateInput",required:""})])],-1)),t("div",mt,[t("div",pt,[e[8]||(e[8]=t("label",{class:"input-group-text",for:"inputGroupSelect01"},[t("img",{src:"/images/icon/user.svg",alt:"",width:"20px"})],-1)),r(t("select",{class:"form-select",id:"inputGroupSelect01","onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s)},[e[7]||(e[7]=t("option",{value:"",disabled:""},"Select Supplier",-1)),(d(!0),u(S,null,P(_.suppliers,s=>(d(),u("option",{key:s.id,value:s.id},[t("span",null,i(s.first_name)+" Â "+i(s.last_name),1)],8,vt))),128))],512),[[x,y.value]])])]),t("div",ht,[t("div",_t,[e[10]||(e[10]=t("label",{class:"input-group-text",for:"inputGroupSelect01"},[t("img",{src:"/images/icon/sale create warehouse.svg",alt:"",width:"20px"})],-1)),r(t("select",{class:"form-select",id:"inputGroupSelect01","onUpdate:modelValue":e[1]||(e[1]=s=>b.value=s)},[e[9]||(e[9]=t("option",{value:"",disabled:""},"Select Warehouse",-1)),(d(!0),u(S,null,P(_.warehouses,s=>(d(),u("option",{key:s.id,value:s.id},i(s.name),9,yt))),128))],512),[[x,b.value]])])])])])]),t("div",bt,[t("div",ft,[t("div",gt,[e[14]||(e[14]=t("div",{class:"card-header card-header-background"},[t("h3",{class:"card-title"},"Purchase Details")],-1)),t("div",wt,[t("table",xt,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",{style:{width:"20%"}},"Product Code"),t("th",{style:{width:"25%"}},"Product name"),t("th",{style:{width:"10%"}},"Cost (Rs)"),t("th",{style:{width:"10%"}},"Discount (%)"),t("th",{style:{width:"10%"}},"Discount (Rs)"),t("th",{style:{width:"10%"}},"Quantity"),t("th",{style:{width:"10%"}},"Subtotal (Rs)"),t("th",{style:{"text-align":"center",width:"8%"}},"Action")])],-1)),t("tbody",null,[(d(!0),u(S,null,P(c.value,s=>(d(),u("tr",{key:s.id},[t("td",null,i(s.code),1),t("td",null,i(s.name),1),t("td",null,i(s.cost),1),t("td",null,[r(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o=>s.discount=o,min:"0",max:"100",onInput:o=>H(s),placeholder:"0"},null,40,Pt),[[h,s.discount]])]),t("td",null,i((s.discount/100*(s.quantity*s.cost)).toFixed(2)),1),t("td",null,[t("div",St,[t("div",kt,[t("button",{class:"btn btn-primary",type:"button",onClick:o=>q(s.id,-1)}," - ",8,qt),r(t("input",{class:"form-control","aria-label":"Quantity input","onUpdate:modelValue":o=>s.quantity=o,min:"1"},null,8,Ct),[[h,s.quantity]]),t("button",{class:"btn btn-primary",type:"button",onClick:o=>q(s.id,1)}," + ",8,Ut)])])]),t("td",null,i((v(s)*s.quantity).toFixed(2)),1),t("td",Dt,[t("a",{onClick:o=>O(s.id),style:{cursor:"pointer"}},e[12]||(e[12]=[t("img",{src:"/images/icon/trash-bin.png",alt:"",width:"25px",height:"25px",class:"table-action-icon"},null,-1)]),8,Tt)])]))),128))])])])])])]),t("div",At,[t("div",Vt,[t("div",It,[e[20]||(e[20]=t("div",{class:"card-header"},[t("h5",{class:"card-title fw-bold"},"Summery")],-1)),t("div",jt,[t("div",Et,[t("div",Mt,[e[15]||(e[15]=t("label",{for:"quantity"},"Purchase Code :",-1)),r(t("input",{type:"text",class:"form-control",id:"purchase_code",placeholder:"Enter Product purchase code","onUpdate:modelValue":e[2]||(e[2]=s=>w.value=s)},null,512),[[h,w.value]]),e[16]||(e[16]=t("div",{class:"invalid-feedback"}," Please Provide Enter purchase code ",-1))])]),t("div",Rt,[e[17]||(e[17]=t("label",{for:"quantity"},"Balance :",-1)),t("div",$t,[t("span",Bt,"Total: Rs "+i(C.value.toFixed(2)),1),r(t("input",{type:"number",class:"form-control",placeholder:"0.00","aria-label":"Recipient's username","aria-describedby":"basic-addon2","onUpdate:modelValue":e[3]||(e[3]=s=>g.value=s)},null,512),[[h,g.value]])])]),t("div",Ft,[t("div",Qt,[e[19]||(e[19]=t("label",{for:"name"},"Payment Type",-1)),r(t("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":e[4]||(e[4]=s=>f.value=s)},e[18]||(e[18]=[t("option",{value:"",disabled:""},"Select Payment Type",-1),t("option",{value:"1"},"Cash",-1),t("option",{value:"3"},"Credit",-1)]),512),[[x,f.value]])])]),t("div",{class:"col-12 text-end"},[t("button",{class:"btn btn-success",onClick:Q},"Save Purchase")])])])])])]),_:1}))}};export{zt as default};
