import{r as o,e as K,f as Z,p as ee,j as L,n as h,i as te,o as n,g as se,h as le,a as e,d as i,v as u,k as _,c as r,l as x,t as d,F as w,s as oe}from"./app-JnpFVuSp.js";import{_ as ae}from"./AdminLayout-CP0E-03s.js";import{$ as ne}from"./dataTables.bootstrap4.min-DdNG8ZfS.js";import"./AdminFooter-CrMPERQ2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"row mb-2"},re={class:"col-sm-6"},de={class:"breadcrumb float-sm-right"},ce={class:"breadcrumb-item"},ue=["href"],ve={class:"breadcrumb-item active"},me=["href"],pe={class:"row mb-4"},fe={class:"col-12"},be={class:"row d-flex justify-content-start"},ge={class:"col-lg-3 col-12"},ye={class:"input-group mb-3"},he={class:"col-lg-3 col-12"},_e={class:"input-group mb-3"},xe=["value"],we={class:"col-lg-3 col-12"},Se={class:"input-group mb-3"},Ce=["value"],ke={class:"col-lg-3 col-12"},Pe={class:"input-group mb-3"},Ee=["value"],Ve={class:"col-lg-3 col-12"},Ue={class:"input-group mb-3"},De=["value"],Te={class:"row"},qe={class:"container result_container"},Ie={key:0,class:"search-result"},Ne=["onClick"],Be={key:1,class:"search-result"},Ae={class:"row",style:{"margin-top":"80px"}},Re={class:"col-12"},$e={class:"card card-primary"},Fe={class:"card-body"},Me={id:"perchesTable",class:"table table-hover"},Le=["onUpdate:modelValue","onInput"],je={class:"row d-flex"},Oe={class:"input-group quantity-group"},Ge=["onClick"],We=["onUpdate:modelValue"],Qe=["onClick"],He={class:"d-flex justify-content-center align-items-center"},Xe=["onClick"],Ye={class:"row d-flex justify-content-end"},ze={class:"col-lg-4",id:"cheque"},Je={class:"card card-primary card-outline"},Ke={class:"card-body"},Ze={class:"col-12"},et={class:"form-group"},tt={class:"col-12"},st={class:"form-group"},lt={class:"col-12"},ot={class:"form-group"},at={class:"col-lg-4"},nt={class:"card card-danger card-outline"},it={class:"card-body"},rt={class:"col-12"},dt={class:"input-group mb-3"},ct={class:"input-group-text",id:"basic-addon2"},yt={__name:"CreateSale",setup(ut){o(null);const m=K();o(0);const p=o(""),S=o(""),f=o(""),v=o([]),b=o(1),g=o(0),k=o(0),c=o([]),P=o(0),E=o(""),V=o(""),U=o(""),D=o("");o(""),o({});const j=async()=>{const l=I(g.value),s={warehouse_id:b.value,products:c.value.map(t=>({product_id:t.id,quantity:+t.sellCount,price:t.price,discount:t.discount??0,discounted_price:C(t),subtotal:C(t)*t.quantity})),total_price:B.value,received_amount:P.value,payment_type:+f.value,todyDate:S.value,shop_id:g.value,ref_id:k.value,credit:l,bank_name:E.value,cheque_number:U.value,expire_date:V.value,order_status:D.value};h.post("/sales",s).then(t=>{var a,y;console.log(t),(a=t==null?void 0:t.data)!=null&&a.message?(localStorage.setItem("successMessage",t.data.message),window.location.href=route("admin.Sales")):(y=t==null?void 0:t.data)!=null&&y.error&&m.error(t.data.error)}).catch(t=>{var a,y,R,$,F,M;(y=(a=t.response)==null?void 0:a.data)!=null&&y.errors?(console.log(($=(R=t.response)==null?void 0:R.data)==null?void 0:$.errors),Object.values(t.response.data.errors||{}).flat().forEach(J=>{m.error(J)})):(M=(F=t.response)==null?void 0:F.data)!=null&&M.message?m.error(t.response.data.message):m.error("An unexpected error occurred."),console.log(t)})},O=async(l,s)=>{if(s.value==0)m.warning("Please Select Warehouse"),document.getElementById("warehouse").style.border="1px solid red";else{document.getElementById("warehouse").style.border="1px solid black !important";try{const t=await h.get(`/admin/search/${l}/${s}`);v.value=t.data,Array.isArray(v)?console.log("Products found:",v):console.log("Single product found:",v)}catch(t){t.response&&t.response.status===404?console.log(t.response.data.message):console.error("An error occurred:",t)}}};function G(){if(b.value==0)m.warning("Please Select Warehouse"),document.getElementById("warehouse").style.border="1px solid red";else{document.getElementById("warehouse").style.border="1px solid red";const l=document.getElementById("offcanvasScrolling");new bootstrap.Offcanvas(l).show()}}Z(()=>{W(),Q(),z();const l=new Date().toISOString().split("T")[0];S.value=l,ee(()=>{ne("#perchesTable").DataTable({responsive:!0,scrollX:!0,scrollY:"300px",scrollCollapse:!0,paging:!0})})}),L(p,()=>{O(p.value,b.value)}),L(f,()=>{console.log("ss"+f.value),f.value==2?document.getElementById("cheque").style.display="block":document.getElementById("cheque").style.display="none"});const q=o([]),W=async()=>{try{const l=await h.get("/warehouses");q.value=l.data}catch(l){console.error("Error fetching courses:",l)}},T=o([]),Q=async()=>{try{const l=await h.get("/shops");T.value=l.data}catch(l){console.error("Error fetching courses:",l)}},I=l=>{const s=T.value.find(t=>t.id===l);return s?s.credit_limit-s.credit:0},H=l=>{const s=c.value.find(t=>t.id===l.id);s?s.sellCount+=1:c.value.push({...l,sellCount:1})},X=l=>{c.value=c.value.filter(s=>s.id!==l)},N=(l,s)=>{const t=c.value.find(a=>a.id===l);t&&(t.sellCount=Math.max(1,t.sellCount+s))},Y=l=>{l.discount<0?l.discount=0:l.discount>100&&(l.discount=100)},C=l=>{const s=l.discount??0,t=l.price*s/100;return l.price-t},B=te(()=>c.value.reduce((l,s)=>{const t=C(s);return l+t*s.sellCount},0)),A=o([]),z=async()=>{try{const l=await h.get("/refs");A.value=l.data,console.log(l)}catch(l){console.error("Error fetching courses:",l)}};return o([]),(l,s)=>(n(),se(ae,null,{default:le(()=>[e("div",ie,[s[12]||(s[12]=e("div",{class:"col-sm-6"},[e("h4",{class:"mt-3"},"CREATE SALES")],-1)),e("div",re,[e("ol",de,[e("li",ce,[e("a",{href:l.route("admin.dashboard")},"HOME",8,ue)]),e("li",ve,[e("a",{href:l.route("admin.Sales")},"SALES",8,me)]),s[11]||(s[11]=e("li",{class:"breadcrumb-item active"},"CREATE SALES",-1))])])]),e("div",pe,[e("div",fe,[e("div",be,[e("div",ge,[e("div",ye,[s[13]||(s[13]=e("span",{class:"input-group-text",id:"basic-addon1"},[e("img",{src:"/images/icon/calendar.png",alt:"",width:"20px"})],-1)),i(e("input",{type:"date",class:"form-control",placeholder:"Username","aria-label":"Username","onUpdate:modelValue":s[0]||(s[0]=t=>S.value=t),"aria-describedby":"basic-addon1",id:"dateInput",required:""},null,512),[[u,S.value]])])]),e("div",he,[e("div",_e,[s[15]||(s[15]=e("label",{class:"input-group-text",for:"inputGroupSelect01"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),i(e("select",{class:"form-select",id:"warehouse","onUpdate:modelValue":s[1]||(s[1]=t=>b.value=t)},[s[14]||(s[14]=e("option",{selected:"",disabled:"",value:"0"},"Select WareHouse",-1)),(n(!0),r(w,null,x(q.value,t=>(n(),r("option",{key:t.id,value:t.id},d(t.name),9,xe))),128))],512),[[_,b.value]])])]),e("div",we,[e("div",Se,[s[17]||(s[17]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),i(e("select",{class:"form-select",id:"shop","onUpdate:modelValue":s[2]||(s[2]=t=>g.value=t)},[s[16]||(s[16]=e("option",{selected:"",disabled:"",value:"0"},"Select shop",-1)),(n(!0),r(w,null,x(T.value,t=>(n(),r("option",{key:t.id,value:t.id},d(t.name),9,Ce))),128))],512),[[_,g.value]])])]),e("div",ke,[e("div",Pe,[s[19]||(s[19]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),i(e("select",{class:"form-select",id:"ref","onUpdate:modelValue":s[3]||(s[3]=t=>k.value=t)},[s[18]||(s[18]=e("option",{selected:"",disabled:"",value:"0"},"Select Ref",-1)),(n(!0),r(w,null,x(A.value,t=>(n(),r("option",{key:t.id,value:t.id},d(t.first_name),9,Ee))),128))],512),[[_,k.value]])])]),e("div",Ve,[e("div",Ue,[s[20]||(s[20]=e("label",{class:"input-group-text",for:"inputGroupSelect02"},[e("img",{src:"/images/icon/home.png",alt:"",width:"20px"})],-1)),e("input",{type:"number",class:"form-control",id:"credit_limit",value:I(g.value),disabled:""},null,8,De)])])])])]),e("div",Te,[e("div",qe,[i(e("input",{class:"form-control",type:"text",placeholder:"Search Products...","aria-label":"default input example","onUpdate:modelValue":s[4]||(s[4]=t=>p.value=t)},null,512),[[u,p.value]]),p.value&&v.value.length>0?(n(),r("div",Ie,[e("ul",null,[(n(!0),r(w,null,x(v.value,t=>(n(),r("li",{key:t.id,onClick:a=>H(t),class:"product-item",style:{cursor:"pointer"}},d(t.name)+" ("+d(t.code)+") - Rs "+d(t.price),9,Ne))),128))])])):p.value&&v.value.length===0?(n(),r("div",Be,s[21]||(s[21]=[e("p",null,"No products found...",-1)]))):oe("",!0)])]),e("div",{class:"row"},[e("div",{class:"col-12 mt-4"},[e("button",{type:"button",class:"btn btn-outline-danger m-2","aria-controls":"offcanvasScrolling",onClick:G}," Category1 ")])]),e("div",Ae,[e("div",Re,[e("div",$e,[s[24]||(s[24]=e("div",{class:"card-header card-header-background"},[e("h3",{class:"card-title"},"Sales Items")],-1)),e("div",Fe,[e("table",Me,[s[23]||(s[23]=e("thead",null,[e("tr",null,[e("th",{style:{width:"8%"}},"Product Code"),e("th",{style:{width:"8%"}},"Product name"),e("th",null,"Price (Rs)"),e("th",null,"Discount (%)"),e("th",null,"Discount (Rs)"),e("th",{style:{width:"15%"}},"Quantity"),e("th",null,"Subtotal (Rs)"),e("th",{style:{"text-align":"center",width:"8%"}},"Action")])],-1)),e("tbody",null,[(n(!0),r(w,null,x(c.value,t=>(n(),r("tr",{key:t.id},[e("td",null,d(t.code),1),e("td",null,d(t.name),1),e("td",null,d(t.price),1),e("td",null,[i(e("input",{type:"number",class:"form-control","onUpdate:modelValue":a=>t.discount=a,min:"0",max:"100",onInput:a=>Y(t),placeholder:"0"},null,40,Le),[[u,t.discount]])]),e("td",null,d((C(t)*t.sellCount).toFixed(2)),1),e("td",null,[e("div",je,[e("div",Oe,[e("button",{class:"btn btn-primary",type:"button",onClick:a=>N(t.id,-1)}," - ",8,Ge),i(e("input",{class:"form-control","aria-label":"Quantity input","onUpdate:modelValue":a=>t.sellCount=a,min:"1"},null,8,We),[[u,t.sellCount]]),e("button",{class:"btn btn-primary",type:"button",onClick:a=>N(t.id,1)}," + ",8,Qe)])])]),e("td",null,d((t.price*t.sellCount).toFixed(2)),1),e("td",He,[e("a",{onClick:a=>X(t.id),style:{cursor:"pointer"}},s[22]||(s[22]=[e("i",{class:"fas fa-solid fa-trash mr-4",style:{color:"#FF0000"}},null,-1)]),8,Xe)])]))),128))])])])])])]),e("div",Ye,[e("div",ze,[e("div",Je,[s[31]||(s[31]=e("div",{class:"card-header"},[e("h5",{class:"card-title fw-bold"},"Cheque Details")],-1)),e("div",Ke,[e("div",Ze,[e("div",et,[s[25]||(s[25]=e("label",{for:"name"},"Bank Name :",-1)),i(e("input",{type:"text",class:"form-control",id:"bank_name",placeholder:"Enter Product Name","onUpdate:modelValue":s[5]||(s[5]=t=>E.value=t)},null,512),[[u,E.value]]),s[26]||(s[26]=e("div",{class:"invalid-feedback"}," Please Provide Enter Product Name ",-1))])]),e("div",tt,[e("div",st,[s[27]||(s[27]=e("label",{for:"name"},"Cheque Number :",-1)),i(e("input",{type:"text",class:"form-control",id:"cheque_number",placeholder:"Enter Product Name","onUpdate:modelValue":s[6]||(s[6]=t=>U.value=t)},null,512),[[u,U.value]]),s[28]||(s[28]=e("div",{class:"invalid-feedback"}," Please Provide Enter Product Name ",-1))])]),e("div",lt,[e("div",ot,[s[29]||(s[29]=e("label",{for:"name"},"Expire Date :",-1)),i(e("input",{type:"date",class:"form-control",id:"expire_date",placeholder:"Enter Product Name","onUpdate:modelValue":s[7]||(s[7]=t=>V.value=t)},null,512),[[u,V.value]]),s[30]||(s[30]=e("div",{class:"invalid-feedback"}," Please Provide Enter Product Name ",-1))])])])])]),e("div",at,[e("div",nt,[s[36]||(s[36]=e("div",{class:"card-header"},[e("h5",{class:"card-title fw-bold"},"Summary")],-1)),e("div",it,[e("div",rt,[e("div",dt,[e("span",ct,"Total: Rs "+d(B.value.toFixed(2)),1),i(e("input",{type:"number",class:"form-control",placeholder:"0.00","aria-label":"Recipient's username","aria-describedby":"basic-addon2","onUpdate:modelValue":s[8]||(s[8]=t=>P.value=t)},null,512),[[u,P.value]])]),s[34]||(s[34]=e("label",{for:"name"},"Payment Type",-1)),i(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":s[9]||(s[9]=t=>f.value=t)},s[32]||(s[32]=[e("option",{value:"",disabled:""},"Select Payment Type",-1),e("option",{value:"1"},"Cash",-1),e("option",{value:"2"},"Cheque",-1),e("option",{value:"3"},"Credit",-1)]),512),[[_,f.value]]),s[35]||(s[35]=e("label",{for:"name"},"Order Status",-1)),i(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":s[10]||(s[10]=t=>D.value=t)},s[33]||(s[33]=[e("option",{value:"",disabled:""},"Select Order Status",-1),e("option",{value:"1"},"Start to Print",-1),e("option",{value:"2"},"Print",-1),e("option",{value:"3"},"Delivered",-1)]),512),[[_,D.value]])]),e("div",{class:"row"},[e("div",{class:"col-12 text-end"},[e("button",{class:"btn btn-success",onClick:j},"Create Sale")])])])])])]),s[37]||(s[37]=e("div",{class:"offcanvas offcanvas-end","data-bs-scroll":"true","data-bs-backdrop":"false",tabindex:"-1",id:"offcanvasScrolling","aria-labelledby":"offcanvasScrollingLabel"},[e("div",{class:"offcanvas-header"},[e("h5",{class:"offcanvas-title",id:"offcanvasScrollingLabel"},"Category Name"),e("button",{type:"button",class:"btn-close text-reset","data-bs-dismiss":"offcanvas","aria-label":"Close"})]),e("div",{class:"offcanvas-body"},[e("div",{class:"row"},[e("div",{class:"container result_container"},[e("input",{class:"form-control",type:"text",placeholder:"Search Products...","aria-label":"default input example"}),e("div",{class:"search-result"},[e("p",null,"456 product")])])]),e("div",{class:"row mt-4"},[e("div",{class:"col-12"}," Product Name (Code) ")])])],-1))]),_:1}))}};export{yt as default};
